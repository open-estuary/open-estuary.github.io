<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>D01-hacking-manual | Open-Estuary</title>
  <meta name="description" content="Open-Estuary Community Boards Support Site" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/css/component.css" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link rel="stylesheet" type="text/css" href="/css/jq-metro.css" />
  <meta name="generator" content="Open-Estuary">
  <script src="http://static.duoshuo.com/embed.js"></script>
  
  
  

  
</head>
<body>
<div class="container">
    <div class="mp-pusher" id="mp-pusher">
        <i id="scroll-up" class="fa fa-angle-up"></i>
        <nav id="mp-menu" class="mp-menu">
            <div class="mp-level">
                <a data-pjax class="back-home" style="font-size: 20px" href="/"><h2 ><i class="fa fa-home"></i>
                        Home</h2></a>
                <ul class="first-level">
                    <li>
                        <a class="fa fa-archive" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Archive</a>
                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-archive"></i>
                                Archive</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-archive" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/08/10/Overview-Introduction/">Overview Introduction</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/08/10/Quick-Start/">Quick Start</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/08/10/Go-Through/">Go Through</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/08/10/Binary-Files/">Binary Files</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/08/10/Shared-Boards-in-Open-Lab/">Shared Boards in Open Lab</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/08/10/Caliper-for-Benchmarking/">Caliper for Benchmarking</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/08/10/UEFI-and-Grub/">UEFI and Grub</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/08/10/Hardware-Boards/">Hardware Boards</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/08/10/Armor-Tools/">Armor Tools</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/04/17/D02/">D02-hacking-manual</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2014/12/23/D01/">D01-hacking-manual</a>
                                </li>
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a class="fa fa-copy" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Categories</a>

                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-copy"></i>
                                Categories</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-category" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a class="fa fa-tags" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Tags</a>
                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-tags"></i>
                                Tags</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-tag" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/Armor-Tools/">&nbsp;&nbsp;&nbsp;Armor Tools</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/Binary-Files/">&nbsp;&nbsp;&nbsp;Binary Files</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/Caliper-for-Benchmarking/">&nbsp;&nbsp;&nbsp;Caliper for Benchmarking</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/D01/">&nbsp;&nbsp;&nbsp;D01</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/D02/">&nbsp;&nbsp;&nbsp;D02</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/Go-Through/">&nbsp;&nbsp;&nbsp;Go Through</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/Hardware-Boards/">&nbsp;&nbsp;&nbsp;Hardware Boards</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/Overview-Introduction/">&nbsp;&nbsp;&nbsp;Overview Introduction</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/Quick-Start/">&nbsp;&nbsp;&nbsp;Quick Start</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/Shared-Boards-in-Open-Lab/">&nbsp;&nbsp;&nbsp;Shared Boards in Open Lab</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/UEFI-and-Grub/">&nbsp;&nbsp;&nbsp;UEFI and Grub</a>
                                    <small>1</small>
                                </li>
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    
                    <li><a class="fa fa-user" href="http://www.open-estuary.io">&nbsp;&nbsp;&nbsp;About me</a></li>
                    <li><a class="fa fa-github" href="https://github.com/open-estuary">&nbsp;&nbsp;&nbsp;Github</a></li>
                    <li><a class="fa fa-bullhorn" href="https://github.com/open-estuary/open-estuary.github.io/issues">&nbsp;&nbsp;&nbsp;Issue Report</a></li>
                </ul>

            </div>
        </nav>
        <div id="pjax">
            <div class="pjax-hidden" style="display: none">
                
                    <a  data-pjax href="/2015/08/10/Overview-Introduction/">Overview Introduction</a>
                
                    <a  data-pjax href="/2015/08/10/Quick-Start/">Quick Start</a>
                
                    <a  data-pjax href="/2015/08/10/Go-Through/">Go Through</a>
                
                    <a  data-pjax href="/2015/08/10/Binary-Files/">Binary Files</a>
                
                    <a  data-pjax href="/2015/08/10/Shared-Boards-in-Open-Lab/">Shared Boards in Open Lab</a>
                
                    <a  data-pjax href="/2015/08/10/Caliper-for-Benchmarking/">Caliper for Benchmarking</a>
                
                    <a  data-pjax href="/2015/08/10/UEFI-and-Grub/">UEFI and Grub</a>
                
                    <a  data-pjax href="/2015/08/10/Hardware-Boards/">Hardware Boards</a>
                
                    <a  data-pjax href="/2015/08/10/Armor-Tools/">Armor Tools</a>
                
                    <a  data-pjax href="/2015/04/17/D02/">D02-hacking-manual</a>
                
                    <a  data-pjax href="/2014/12/23/D01/">D01-hacking-manual</a>
                
                
                
                    <a data-pjax href="/tags/Armor-Tools/">&nbsp;&nbsp;Armor Tools</a>
                
                    <a data-pjax href="/tags/Binary-Files/">&nbsp;&nbsp;Binary Files</a>
                
                    <a data-pjax href="/tags/Caliper-for-Benchmarking/">&nbsp;&nbsp;Caliper for Benchmarking</a>
                
                    <a data-pjax href="/tags/D01/">&nbsp;&nbsp;D01</a>
                
                    <a data-pjax href="/tags/D02/">&nbsp;&nbsp;D02</a>
                
                    <a data-pjax href="/tags/Go-Through/">&nbsp;&nbsp;Go Through</a>
                
                    <a data-pjax href="/tags/Hardware-Boards/">&nbsp;&nbsp;Hardware Boards</a>
                
                    <a data-pjax href="/tags/Overview-Introduction/">&nbsp;&nbsp;Overview Introduction</a>
                
                    <a data-pjax href="/tags/Quick-Start/">&nbsp;&nbsp;Quick Start</a>
                
                    <a data-pjax href="/tags/Shared-Boards-in-Open-Lab/">&nbsp;&nbsp;Shared Boards in Open Lab</a>
                
                    <a data-pjax href="/tags/UEFI-and-Grub/">&nbsp;&nbsp;UEFI and Grub</a>
                
                <a data-pjax class="fa fa-user" href="/about">&nbsp;&nbsp;&nbsp;About me</a>
            </div>
            <nav class="nexus">
                <li  style="border-left: 1px solid #c6d0da;">
                    <a id="trigger" href="#"><i class="fa fa-bars"></i></a>
                </li>
                <li ><a id="nexus-back" href="/">Open-Estuary</a></li>
                
                <div id="nav-container">
                    <div class="post-navbar" style="line-height: 63px;display:none">
                        <li id="navbar-title"><a href="#">D01-hacking-manual</a></li>
                        <li id="navbar-toc" style="border-left: none">
                            <a style="padding-right: 15px">
                                <span id="toc-content" >Introduction</span><i class="fa fa-chevron-down" ></i>
                            </a>
                            <div class="hidden-box">
                                <ul id="toc"></ul>
                            </div>
                        </li>
                    </div>
                </div>
                
            </nav>

            <div class="scroller">
            <div class="scroller-inner">


<!-- -->
<!--<body class="post-template">-->
<!---->
  

<main class="content" role="main">
    <article class="post" >
    <span class="post-meta">
                  <div class="tag-tile">
                      
                      
                      <a data-pjax href='/tags/D01/' style='color:#D5D5D5'>D01</a>
                      
                      
                  </div>
                <h1 class="post-title" style="margin: 14px 0;color:#50585D">D01-hacking-manual</h1>

                    <div class="post-meta">
                        Post on<span class="fa fa-clock-o"></span>
                        <time datetime="2014-12-23T09:06:54.000Z"
                              itemprop="datePublished">Dec 23 2014</time>
                    </div>
    </span>

        <section class="post-content">
            <h1 id="Open-Estuary_Opensource_Board_D01_hacking_manual">Open-Estuary Opensource Board D01 hacking manual</h1>
<pre><code>/<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>/
/<span class="keyword">*</span> Justin Zhao          <span class="keyword">*</span>/
/<span class="keyword">*</span> justin-zhao<span class="comment">@qq.com   */</span>
/<span class="keyword">*</span> v2.0                 <span class="keyword">*</span>/
/<span class="keyword">*</span> 2014-12-18           <span class="keyword">*</span>/
/<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>/
</code></pre><h2 id="Overview">Overview</h2>
<ul>
<li><a href="#hardware">D01 Board Hardware Featuers</a></li>
<li><a href="#solution">D01 Software Solution and Status</a><ul>
<li><a href="#uefi">UEFI</a></li>
<li><a href="#bootwrapper">BootWrapper</a></li>
<li><a href="#grub">GRUB</a></li>
<li><a href="#stub">EFI Stub</a></li>
<li><a href="#kernel">Kernel</a></li>
<li><a href="#osv">Distributions</a></li>
<li><a href="#toolchain">Toolchain</a></li>
<li><a href="#release">Release</a></li>
</ul>
</li>
<li><a href="#hacking">D01 Hacking</a><ul>
<li><a href="#uefihacking">UEFI hacking</a><ul>
<li><a href="#compileuefi">compile UEFI source code</a></li>
<li><a href="#uefishell">boot D01 to UEFI shell</a></li>
<li><a href="#upgradeuefi">upgrade UEFI</a></li>
<li><a href="#restoreuefi">how to restore the UEFI when the UEFI did not work</a></li>
</ul>
</li>
<li><a href="#bootwrapperhacking">Bootwrapper hacking</a><ul>
<li><a href="#compilebootwrapper">compile BootWrapper source code</a></li>
<li><a href="#upgradebootwrapper">upgrade BootWrapper</a></li>
</ul>
</li>
<li><a href="#grubhacking">Grub hacking</a></li>
<li><a href="#kernelhacking">Kernel hacking</a></li>
<li><a href="#nandboot">boot via NAND</a><ul>
<li><a href="#upgradekernel">upgrade kernel and NAND rootfs</a></li>
<li><a href="#changecommandline">show &amp; change kernel command line in UEFI</a></li>
<li><a href="#nandfsboot">boot into NAND Rootfs</a></li>
<li><a href="#nfsboot">boot into NFS</a></li>
<li><a href="#ubuntuboot">boot into Ubuntu on SATA</a></li>
</ul>
</li>
<li><a href="#pxeboot">boot via PXE</a><ul>
<li><a href="#installtftp">set up TFTP server</a></li>
<li><a href="#installtftp">set up DHCP server</a></li>
<li><a href="#enterpxe">enter PXE in the UEFI shell</a></li>
</ul>
</li>
<li><a href="#stubboot">boot via EFI-stub</a><ul>
<li><a href="#compilestubkernel">compile kernel with EFI stub</a></li>
<li><a href="#installefi">install EFI-stub kernel on SATA disk</a></li>
<li><a href="#enterefi">launch EFI-stub Kernel in the UEFI shell</a></li>
</ul>
</li>
<li><a href="#grubboot">boot via GRUB</a><ul>
<li><a href="#installgrub">install GRUB on SATA disk</a></li>
<li><a href="#entergrub">launch GRUB in the UEFI shell</a></li>
</ul>
</li>
<li><a href="#kvm">KVM on D01</a></li>
<li><a href="#xen">Xen on D01</a></li>
</ul>
</li>
<li><a href="#refer">Reference</a></li>
</ul>
<p><a name="hardware"></a></p>
<h2 id="D01_Board_Hardware_Featuers">D01 Board Hardware Featuers</h2>
<p>Major hardware features of D01 are listed here.                               </p>
<pre><code><span class="code">+----------+</span>---------------------------------------------------------+
<span class="header">|Features  |Description                                              |
+----------+---------------------------------------------------------+</span>
|Processors|Integrated 16 x ARM Cortex-A15 CPU Core @ max. 1.5GHz    |
|          |Support for up to 84000 DMIPS                            |
|          |Support for CPU configuration as AMP/SMP                 |
|          |Configurable Big or Littile endian,default Little endian |
|          |Support ARMv7-A instruction set                          |
<span class="header">|          |Support float VFPv4 instruction set                      |
+----------+---------------------------------------------------------+</span>
|Memory    |Two 64bit DDR3 DRAM Dual Inline                          |
|          |Memory Module(DIMM) sockets:(2)&amp;(3)                      |
|          |Maximum frequency of 1600 MHz                            |
|          |Maximum capacity of 64GB                                 |
|          |preassembled capacity:16GB                               |
|          |Built-in two 1Gb NOR Flash;                              |
|          |only one NOR flash could use by software:(29)            |
<span class="header">|          |Built-in two 512MB NAND Flash:(30)                       |
+----------+---------------------------------------------------------+</span>
<span class="header">|GPU       |None                                                     |
+----------+---------------------------------------------------------+</span>
|Peripheral|TWO USB2.0 Host port:(11)                                |
|Interfaces|Two UART interfaces:(12)&amp;(13)                            |
|          |Four I2C interfaces                                      |
|          |One SPI interface, supporting four CSs                   |
|          |One SD card interface:(10)                               |
|          |GPIO: eight LED interfaces:(26);eight switchs:(25)       |
|          |Three SATA interfaces(2.5in SATA 3.0 6Gbps):(4)&amp;(5)&amp;(6)  |
|          |Tracer Connector x2:(19)&amp;(20)                            |
<span class="header">|          |One JTAG interfaces(5x2 pin, ARM Connector):(24)         |
+----------+---------------------------------------------------------+</span>
|BIOS      |BIOS resident in NOR Flash                               |
<span class="header">|          |Support for update with FTP                              |
+----------+---------------------------------------------------------+</span>
|LAN       |Two 10/100/1000Mbit/s Gigabit Ethernet ports:(15)&amp;(16)   |
<span class="header">|          |One 10/100Mbit/s FE port:(14)                            |
+----------+---------------------------------------------------------+</span>
|Hardware  |Power consumption sense                                  |
<span class="header">|Monitor   |                                                         |
+----------+---------------------------------------------------------+</span>
|Input     |None                                                     |
<span class="header">|Devices   |                                                         |
+----------+---------------------------------------------------------+</span>
|Other     |One hardware button for power-off:(8)                    |
<span class="header">|          |One hardware button for reset:(9)                        |
+----------+---------------------------------------------------------+</span>
</code></pre><p><a name="pic"><br>Refer to the following picture to know<br>where each component below is physically located.    </a></p>
<p><img src="http://7vilkn.com1.z0.glb.clouddn.com/d01-portrait.png" style="width:700px;height:500px;margin-left:30px"> </p>
<p><a name="solution"> </a></p>
<h2 id="D01_Software_Solution_and_Status">D01 Software Solution and Status</h2>
<p>The software architecture on D01 is consisted of <a href="#uefi">UEFI</a>, <a href="#bootwrapper">BootWrapper</a><br>, <a href="#grub">GRUB</a>, <a href="#stub">EFI Stub</a>, <a href="#kernel">Kernel</a>, <a href="#osv">Distributions</a> and<br><a href="#toolchain">Toolchain</a>. The big picture is like following:</p>
<pre><code>      +--------------------------+ +-----+
      |  <span class="class">NANDRootfs</span> <span class="class">Ubuntu</span>       | |  <span class="class">T</span>  |
      |  <span class="class">OpenSuse</span> <span class="class">Debian</span> <span class="class">Fedora</span>  | <span class="localvars">|  o  |</span>
      +--------------------------+ <span class="localvars">|  o  |</span>
      |         <span class="class">Kernel</span>           | <span class="localvars">|  l  |</span>
      +-----------+              | |  <span class="class">C</span>  |
      |    <span class="class">GRUB</span>   |   <span class="class">EFI</span>-<span class="class">STUB</span>   | <span class="localvars">|  h  |</span>
      +----+------+--------+-----+ <span class="localvars">|  a  |</span>
      |    |  <span class="class">BootWrapper</span>  |     | <span class="localvars">|  i  |</span>
      |    +---------------+     | <span class="localvars">|  n  |</span>
      |           <span class="class">UEFI</span>           | |     |
      | +-------+-------+-----+  | |     |
      | | <span class="class">NANDC</span> | <span class="class">SATAC</span> | <span class="class">PXE</span> |  | |     |
      | +-------+-------+-----+  | |     |
      +--------------------------+ +-----+
</code></pre><p><a name="release"><br>And you could download the binary from the link:</a></p>
<pre><code>    https://github.com/open-estuary/boards/tree/master/D01/<span class="operator"><span class="keyword">release</span>

    +<span class="comment">------------------+------------------------------------+       </span>
    |  filename        |    description                     |
    +<span class="comment">------------------+------------------------------------+       </span>
    |  D01.fd          |    UEFI <span class="built_in">binary</span>                     |
    +<span class="comment">------------------+------------------------------------+       </span>
    |  .<span class="built_in">text</span>           |    bootwrapper, HYP switch part    |   
    +<span class="comment">------------------+------------------------------------+       </span>
    |  .monitor        |    bootwrapper, monitor part       |
    +<span class="comment">------------------+------------------------------------+       </span>
    |  grub2.efi       |    grub <span class="built_in">binary</span>                     |
    +<span class="comment">------------------+------------------------------------+       </span>
    |  grub.cfg        |    grub configure                  |       
    +<span class="comment">------------------+------------------------------------+       </span>
    |  .kernel         |    zImage, <span class="keyword">with</span> dtb concatenatea   |   
    +<span class="comment">------------------+------------------------------------+       </span>
    |  zImage          |    kernel image                    |
    +<span class="comment">------------------+------------------------------------+       </span>
    |  hip04-d01.dtb   |    D01 device tree bianry          |   
    +<span class="comment">------------------+------------------------------------+       </span>
    |  .filesystem     |    initramfs stored <span class="keyword">in</span> NAND        |   
    +<span class="comment">------------------+------------------------------------+       </span></span>
</code></pre><p>Linaro also provide a monthly release for it:</p>
<pre><code>     http:<span class="comment">//www.linaro.org/downloads/ </span>
</code></pre><h3 id="The_function_of_each_component">The function of each component</h3>
<p><a name="uefi"></a></p>
<ul>
<li><p><a href="http://uefi.org/about" target="_blank" rel="external">UEFI</a>: responsible for loading and booting kernel  </p>
<p>  could get the source code from following git tree</p>
<pre><code>  http<span class="variable">s:</span>//github.<span class="keyword">com</span>/<span class="keyword">open</span>-estuary/UEFI.git
  http<span class="variable">s:</span>//git.linaro.org/landing-teams/working/<span class="keyword">open</span>-estuary/uefi.git
  http<span class="variable">s:</span>//git.linaro.org/uefi/linaro-edk2.git
</code></pre><p>  And could download monthly binary from:</p>
<pre><code>  <span class="symbol">http:</span>/<span class="regexp">/releases.linaro.org/latest</span><span class="regexp">/components/kernel</span><span class="regexp">/uefi-linaro</span>
</code></pre></li>
</ul>
<p><a name="bootwrapper"></a></p>
<ul>
<li><p>BootWrapper: responsible for switching into HYP mode for slave cores  </p>
<p>  could get the source code from following git tree</p>
<pre><code>  http<span class="variable">s:</span>//github.<span class="keyword">com</span>/<span class="keyword">open</span>-estuary/bootwrapper.git
</code></pre><p>  And it is based on following git tree:</p>
<pre><code>  http<span class="variable">s:</span>//git.linaro.org/arm/models/boot-wrapper.git
  http<span class="variable">s:</span>//github.<span class="keyword">com</span>/virtualopensystems/boot-wrapper.git
</code></pre></li>
</ul>
<p><a name="grub"> </a></p>
<ul>
<li><p><a href="http://www.gnu.org/software/grub/" target="_blank" rel="external">GRUB</a>: responsible for loading kernel </p>
<p>  could get the source code from following git tree</p>
<pre><code>  http<span class="variable">s:</span>//github.<span class="keyword">com</span>/<span class="keyword">open</span>-estuary/grub.git
</code></pre><p>  And it is based on Leif’s grub: <code>http://bazaar.launchpad.net/~leif-lindholm/linaro-grub/arm-uefi</code><br>  I have confrimed that we could not use the mainline grub: <code>git://git.savannah.gnu.org/grub.git</code></p>
</li>
</ul>
<p><a name="stub"></a></p>
<ul>
<li><p>EFI-STUB: responsible for adding PE HEAD into Kernel Image and making it like<br>  a UEFI application.  </p>
<p>  In this case, UEFI could directly load and boot the kernel<br>  from the <strong>FAT32 partion</strong>(because our UEFI SATA driver could only support this type)<br>  in the harddisk without <strong>GRUB</strong>.</p>
<p><a name="kernel"></a></p>
</li>
<li><p><a href="http://www.kernel.org" target="_blank" rel="external">kernel</a>: our operate system</p>
<p>  could get the source code from following git tree</p>
<pre><code>  <span class="keyword">https</span>://github.com/<span class="built_in">open</span>-estuary/linux-hisi.git tag:D01-<span class="number">3.18</span>-release

  <span class="keyword">https</span>://git.linaro.org/landing-teams/working/<span class="built_in">open</span>-estuary/kernel.git 
  branch: integration-hilt-linux-linaro <span class="operator">or</span> integration-hilt-working-v3<span class="number">.14</span>

  <span class="keyword">https</span>://git.linaro.org/kernel/linux-linaro-tracking.git
  <span class="keyword">https</span>://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git
</code></pre><p>  Most of the featuers have already merged into kernel mainline.<br>  But some of features is not accepted like: <strong>Ethernet driver, VGIC, SMMU with SATA<br>  and reboot</strong>.<br>  Following is the commits list need to maintain by ourselves</p>
<pre><code>  Ethernet dirver:
  791a2af hip04: dts: <span class="operator"><span class="keyword">update</span> eth resource
  a162505 hip04: dts: <span class="keyword">add</span> mdio resource
  <span class="number">90</span>edc4d hip04: dts: <span class="keyword">add</span> ether resource
  bbdab0b hip04: serdes: fix build error due <span class="keyword">to</span> macro __DATE__
  <span class="number">2</span>d326b0 misc: <span class="keyword">add</span> sirdes driver

  VGIC:
  http://article.gmane.org/gmane.linux.ports.arm.kernel/<span class="number">344932</span>/raw

  SMMU <span class="keyword">with</span> SATA:
  commits: e5baf66 <span class="number">2921667</span> <span class="keyword">on</span> branch: testing/<span class="number">0429</span>-<span class="keyword">for</span>-xuwei <span class="keyword">in</span>
  https://git.linaro.org/landing-teams/working/<span class="keyword">open</span>-estuary/kernel.git 

  Reboot:
  <span class="keyword">commit</span>: <span class="number">4469</span>f84 <span class="keyword">at</span> branch: integration-hilt-d01 <span class="keyword">in</span>
  https://git.linaro.org/landing-teams/working/<span class="keyword">open</span>-estuary/kernel.git </span>
</code></pre><p>  And you could run following commands to pick them up:</p>
<pre><code>  <span class="comment">git</span> <span class="comment">cherry</span><span class="literal">-</span><span class="comment">pick</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">strategy</span> <span class="comment">recursive</span> <span class="literal">-</span><span class="comment">X</span> <span class="comment">theirs</span> <span class="comment">2d326b0</span>
  <span class="comment">git</span> <span class="comment">cherry</span><span class="literal">-</span><span class="comment">pick</span> <span class="comment">bbdab0b</span>
  <span class="comment">git</span> <span class="comment">cherry</span><span class="literal">-</span><span class="comment">pick</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">strategy</span> <span class="comment">recursive</span> <span class="literal">-</span><span class="comment">X</span> <span class="comment">theirs</span> <span class="comment">90edc4d</span>
  <span class="comment">git</span> <span class="comment">cherry</span><span class="literal">-</span><span class="comment">pick</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">strategy</span> <span class="comment">recursive</span> <span class="literal">-</span><span class="comment">X</span> <span class="comment">theirs</span> <span class="comment">a162505</span>
  <span class="comment">git</span> <span class="comment">cherry</span><span class="literal">-</span><span class="comment">pick</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">strategy</span> <span class="comment">recursive</span> <span class="literal">-</span><span class="comment">X</span> <span class="comment">theirs</span> <span class="comment">791a2af</span>
</code></pre></li>
</ul>
<p><a name="osv"> </a></p>
<ul>
<li><p>Linux Distributions: each distribution is downloaded from itself website<br>  or from Linaro.</p>
<pre><code>  +<span class="comment">-----------+------------------------------------------------+</span>
  |  Ubuntu   |  <span class="keyword">http</span>://releases.linaro.org/latest/ubuntu      |
  +<span class="comment">-----------+------------------------------------------------+</span>
  |  OpenSuse |                                                |
  +<span class="comment">-----------+------------------------------------------------+</span>
  |  Fedora   |                                                |
  +<span class="comment">-----------+------------------------------------------------+</span>
  |  Debian   |                                                |
  +<span class="comment">-----------+------------------------------------------------+</span>
</code></pre><p>  But the NAND Rootfs is created by ourselves and it could download from:</p>
<pre><code>  <span class="symbol">https:</span>/<span class="regexp">/github.com/open</span>-estuary/boards/blob/master/<span class="constant">D01</span>/release/.filesystem
  <span class="symbol">http:</span>/<span class="regexp">/releases.linaro.org/latest</span><span class="regexp">/ubuntu/boards</span><span class="regexp">/lt-d01/</span>.filesystem
</code></pre></li>
</ul>
<p><a name="toolchain">        </a></p>
<ul>
<li><p>ToolChain: used to compile and debug and downdload from  </p>
<pre><code>  http:<span class="comment">//releases.linaro.org/14.09/components/toolchain/binaries/gcc-linaro-arm-linux-gnueabihf-4.9-2014.09_linux.tar.xz       </span>
</code></pre></li>
</ul>
<p><a name="hacking"> </a></p>
<h2 id="D01_Hacking">D01 Hacking</h2>
<ul>
<li><a href="#uefihacking">UEFI hacking</a><ul>
<li><a href="#compileuefi">compile UEFI source code</a></li>
<li><a href="#uefishell">boot D01 to UEFI shell</a></li>
<li><a href="#upgradeuefi">upgrade UEFI</a></li>
<li><a href="#restoreuefi">how to restore the UEFI when the UEFI did not work</a></li>
</ul>
</li>
<li><a href="#bootwrapperhacking">Bootwrapper hacking</a><ul>
<li><a href="#compilebootwrapper">compile BootWrapper source code</a></li>
<li><a href="#upgradebootwrapper">upgrade BootWrapper</a></li>
</ul>
</li>
<li><a href="#grubhacking">Grub hacking</a></li>
<li><a href="#kernelhacking">Kernel hacking</a></li>
<li><a href="#nandboot">boot via NAND</a><ul>
<li><a href="#upgradekernel">upgrade kernel and NAND rootfs</a></li>
<li><a href="#changecommandline">show &amp; change kernel command line in UEFI</a></li>
<li><a href="#nandfsboot">boot into NAND Rootfs</a></li>
<li><a href="#nfsboot">boot into NFS</a></li>
<li><a href="#ubuntuboot">boot into Ubuntu on SATA</a></li>
</ul>
</li>
<li><a href="#pxeboot">boot via PXE</a><ul>
<li><a href="#installtftp">set up TFTP server</a></li>
<li><a href="#installtftp">set up DHCP server</a></li>
<li><a href="#enterpxe">enter PXE in the UEFI shell</a></li>
</ul>
</li>
<li><a href="#stubboot">boot via EFI-stub</a><ul>
<li><a href="#compilestubkernel">compile kernel with EFI stub</a></li>
<li><a href="#installefi">install EFI-stub kernel on SATA disk</a></li>
<li><a href="#enterefi">launch EFI-stub Kernel in the UEFI shell</a></li>
</ul>
</li>
<li><a href="#grubboot">boot via GRUB</a><ul>
<li><a href="#installgrub">install GRUB on SATA disk</a></li>
<li><a href="#entergrub">launch GRUB in the UEFI shell</a></li>
</ul>
</li>
<li><a href="#kvm">KVM on D01</a></li>
<li><a href="#xen">Xen on D01</a></li>
</ul>
<p><a name="uefihacking"></a></p>
<h3 id="UEFI_hacking">UEFI hacking</h3>
<p>FTP protocol is used in D01 UEFI for file downloading.<br>So, before this step, please make sure you have a working<br>FTP server running in your local network.<br>And D01 can use FTP to get files from network.</p>
<p><a name="compileuefi"></a></p>
<h4 id="compile_UEFI_source_code">compile UEFI source code</h4>
<p>A general guideline is here: https://wiki.linaro.org/LEG/Engineering/Kernel/UEFI/build<br>For simplicity, to build UEFI for D01 board, follow these steps:</p>
<ol>
<li><p>Prepare build environment on your Ubuntu PC:</p>
<pre><code> sudo apt-get <span class="operator"><span class="keyword">install</span> <span class="keyword">uuid</span>-dev build-essential gcc-arm-linux-gnueabi
 sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> gcc-arm-linux-gnueabihf</span>
</code></pre><p> Clone Linaro’s uefi tools.</p>
<pre><code>  <span class="title">cd</span> <span class="regexp">~
  git</span> clone <span class="url">git://git.linaro.org/uefi/uefi-tools.git</span>
  export PATH=<span class="variable">$PATH</span>:~/uefi-tools.git
</code></pre><p> Enter uefi-tools, add a build item for D01.<br> Note: This will be submitted into Linaro uefi-tools.git soon.<br> If you found it already there, don’t panic.</p>
<pre><code> diff --git a/platforms.config b/platforms.config
 index <span class="number">2</span>c29a29..<span class="number">7710</span>b80 <span class="number">100755</span>
 --- a/platforms.config
 +++ b/platforms.config
 @@ -<span class="number">132</span>,<span class="number">3</span> +<span class="number">132</span>,<span class="number">10</span> @@ <span class="variable">BUILDFLAGS=</span>
  <span class="variable">DSC=</span>BeagleBoardPkg/BeagleBoardPkg.dsc
  <span class="variable">ARCH=</span>ARM
  [/]
 +
 +[d01]
 +<span class="variable">LONGNAME=</span>HiSilicon D01 Cortex-A15 <span class="number">16</span>-cores
 +<span class="variable">BUILDFLAGS=</span>-D <span class="variable">EDK2_ARMVE_STANDALONE=</span><span class="number">1</span>
 +<span class="variable">DSC=</span>HisiPkg/D01BoardPkg/D01BoardPkg.dsc
 +<span class="variable">ARCH=</span>ARM
 +[/]
</code></pre></li>
<li><p>download D01 UEFI source code from <a href="#uefi">above section</a></p>
</li>
<li><p>Enter your uefi source code folder, and run uefi-build.sh to build.</p>
<pre><code> <span class="keyword">cd</span> your/path/<span class="keyword">to</span>/uefi/<span class="keyword">source</span>;
 uefi-build.<span class="keyword">sh</span> -<span class="keyword">b</span> DEBUG d01
</code></pre><p> Note: for a release version.</p>
<pre><code> uefi-build.<span class="keyword">sh</span> -<span class="keyword">b</span> RELEASE d01
</code></pre><p> When finished, you can find the build result here:</p>
<pre><code> <span class="keyword">ls</span> -<span class="keyword">la</span> Build/D01/DEBUG_GCC46/FV/D01.fd
</code></pre><p> Note: for a release version:</p>
<pre><code> <span class="keyword">ls</span> -<span class="keyword">la</span> Build/D01/RELEASE_GCC46/FV/D01.fd
</code></pre></li>
</ol>
<p><a name="uefishell"> </a></p>
<h4 id="boot_D01_to_UEFI_shell(EBL)">boot D01 to UEFI shell(EBL)</h4>
<ol>
<li><p>Make sure Jumper J39 is in position 1 and 2.(This means to use custom UEFI.<br>If position 2 and 3 are connected, it will boot with the default UEFI,<br>which could never be flashed.)</p>
</li>
<li><p>Serial console (Connector UART0): 115200/8/N/1</p>
</li>
<li><p>Ethernet (FE, J44)</p>
</li>
<li><p>The board is shipped with a power adapter. Apply it to the board,<br>and turn it on.You should be able to see output in serial console now.</p>
</li>
<li><p>Keep pressing ‘s’ in minicom or other serial terminal to start UEFI Boot Menu.<br>Select [b] EBL. Type in ‘help’ to see all commands supported in EBL.</p>
</li>
</ol>
<p><a name="upgradeuefi"></a></p>
<h4 id="upgrade_UEFI">upgrade UEFI</h4>
<ol>
<li><p>download <a href="#release"><code>D01.fd</code></a> the UEFI binary file or <a href="#compileuefi">compile</a> it by yourself</p>
</li>
<li><p>copy the <code>D01.fd</code> to the FTP server</p>
</li>
<li><p><a href="#uefishell">Enter EBL</a> as described above. </p>
</li>
<li><p>Type in these commands: </p>
<pre><code> <span class="tag">IP</span> <span class="tag">address</span> <span class="tag">config</span>:
     &gt; <span class="tag">ifconfig</span> <span class="tag">-s</span> <span class="tag">eth0</span> <span class="attr_selector">[IP.address]</span> <span class="attr_selector">[mask]</span> <span class="attr_selector">[gateway]</span>
       <span class="tag">eg</span>. <span class="tag">ifconfig</span> <span class="tag">-s</span> <span class="tag">eth0</span> 192<span class="class">.168</span><span class="class">.10</span><span class="class">.155</span> 255<span class="class">.255</span><span class="class">.255</span><span class="class">.0</span> 192<span class="class">.168</span><span class="class">.10</span><span class="class">.1</span>
 <span class="tag">download</span> <span class="tag">from</span> <span class="tag">FTP</span> <span class="tag">server</span> (<span class="tag">Note</span>, <span class="tag">filename</span> <span class="tag">must</span> <span class="tag">be</span> <span class="tag">EFI-BOOT</span><span class="class">.fd</span>)
     &gt; <span class="tag">provision</span> <span class="attr_selector">[server.IP]</span> <span class="tag">-u</span> <span class="attr_selector">[user.name]</span> <span class="tag">-p</span> <span class="attr_selector">[passwd]</span> <span class="tag">-f</span> <span class="tag">EFI-BOOT</span><span class="class">.fd</span>
       <span class="tag">eg</span>. <span class="tag">provision</span> 192<span class="class">.168</span><span class="class">.10</span><span class="class">.6</span> <span class="tag">-u</span> <span class="tag">dj</span> <span class="tag">-p</span> <span class="tag">dj</span> <span class="tag">-f</span> <span class="tag">EFI-BOOT</span><span class="class">.fd</span>
 <span class="tag">flash</span> <span class="tag">to</span> <span class="tag">NOR</span>:
     &gt; <span class="tag">updateL1</span> <span class="tag">EFI-BOOT</span><span class="class">.fd</span>
</code></pre></li>
<li><p>reboot the D01 board</p>
</li>
</ol>
<p><a name="restoreuefi"></a></p>
<h4 id="how_to_restore_the_UEFI_when_the_UEFI_did_not_work">how to restore the UEFI when the UEFI did not work</h4>
<p>In case of failure in UEFI, you can always switch to a factory default<br>(known-good, non-erasable) UEFI by shorting Pin 2 and Pin 3 of J39.<br>(Refer to Mark 18 of <a href="#pic">d01-portrait.png</a>)</p>
<ol>
<li><p>Power off the board, disconnect power supply</p>
</li>
<li><p>Short Pin 2 and Pin 3 of J39 (Leave Pin 1 unconnected)</p>
</li>
<li><p>On your client (minicom or similar tools),<br>change UART baudrate to 9600 or 115200</p>
</li>
<li><p>Apply power to the board, turn it on</p>
</li>
<li><p>Following above steps to <a href="#upgradeuefi">upgrade UEFI</a></p>
</li>
<li><p>Power off the board, disconnect power supply</p>
</li>
<li><p>Short Pin 1 and Pin 2 of J39 (Leave Pin 3 unconnected)</p>
</li>
<li><p>On your client, change UART baudrate to 115200. (That’s usually the case.<br>Unless you know that you are using a 9600 baudrate UEFI.)</p>
</li>
</ol>
<p><a name="bootwrapperhacking"></a></p>
<h3 id="BootWrapper_Hacking">BootWrapper Hacking</h3>
<p><a name="compilebootwrapper"></a></p>
<h4 id="compile_BootWrapper_source_code">compile BootWrapper source code</h4>
<ol>
<li><p>download BootWrapper source code from <a href="#bootwrapper">above section</a></p>
</li>
<li><p>use <code>make</code> command to compile and it will generate <code>.text</code> and <code>.monitor</code></p>
</li>
</ol>
<p><a name="upgradebootwrapper"></a></p>
<h4 id="upgrade_Bootwrapper">upgrade Bootwrapper</h4>
<p>Boot D01 to UEFI shell. And in EBL, type in these commands:</p>
<ol>
<li><p>IP address config:</p>
<pre><code> &gt; <span class="tag">ifconfig</span> <span class="tag">-s</span> <span class="tag">eth0</span> <span class="attr_selector">[IP.address]</span> <span class="attr_selector">[mask]</span> <span class="attr_selector">[gateway]</span>
   <span class="tag">eg</span>. <span class="tag">ifconfig</span> <span class="tag">-s</span> <span class="tag">eth0</span> 192<span class="class">.168</span><span class="class">.10</span><span class="class">.155</span> 255<span class="class">.255</span><span class="class">.255</span><span class="class">.0</span> 192<span class="class">.168</span><span class="class">.10</span><span class="class">.1</span>
</code></pre></li>
<li><p>download BootWrapper binary from FTP server (Note, filenames must not be changed):  </p>
<pre><code> &gt; <span class="tag">provision</span> <span class="attr_selector">[server.IP]</span> <span class="tag">-u</span> <span class="attr_selector">[user.name]</span> <span class="tag">-p</span> <span class="attr_selector">[passwd]</span> <span class="tag">-f</span> <span class="class">.text</span>
 &gt; <span class="tag">provision</span> <span class="attr_selector">[server.IP]</span> <span class="tag">-u</span> <span class="attr_selector">[user.name]</span> <span class="tag">-p</span> <span class="attr_selector">[passwd]</span> <span class="tag">-f</span> <span class="class">.monitor</span>
   <span class="tag">eg</span>. <span class="tag">provision</span> 192<span class="class">.168</span><span class="class">.10</span><span class="class">.6</span> <span class="tag">-u</span> <span class="tag">dj</span> <span class="tag">-p</span> <span class="tag">dj</span> <span class="tag">-f</span> <span class="class">.text</span>
   <span class="tag">eg</span>. <span class="tag">provision</span> 192<span class="class">.168</span><span class="class">.10</span><span class="class">.6</span> <span class="tag">-u</span> <span class="tag">dj</span> <span class="tag">-p</span> <span class="tag">dj</span> <span class="tag">-f</span> <span class="class">.monitor</span>
</code></pre></li>
<li><p>Reboot D01</p>
</li>
</ol>
<p><a name="grubhacking"></a></p>
<h3 id="Grub_Hacking">Grub Hacking</h3>
<ol>
<li><p>Prepare build environment on your Ubuntu PC:</p>
<pre><code> <span class="built_in">sudo</span> apt-get install autoconf autogen automake bison flex libfreetype6 libfreetype6-dev
</code></pre></li>
<li><p>Download Grub source code from <a href="#grub">above section</a></p>
</li>
<li><p>Run following commands to build:</p>
<pre><code> <span class="keyword">cd</span> grub
 ./autogen.<span class="keyword">sh</span>
 CROSS_COMPILE=arm-linux-gnueabihf- ./configure --target=arm-linux-gnueabihf --with-platform=efi --prefix=$HOME/grub2-build/
 <span class="keyword">make</span> &amp;&amp; <span class="keyword">make</span> install
</code></pre></li>
</ol>
<p><a name="kernelhacking"></a></p>
<h3 id="Kernel_Hacking">Kernel Hacking</h3>
<ol>
<li><p>download kernel source code from <a href="#kernel">above section</a></p>
</li>
<li><p>use following command to compile:</p>
<pre><code> <span class="keyword">make</span>  ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- O=../linux-<span class="keyword">next</span>.build hisi_defconfig
 <span class="keyword">make</span>  ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- O=../linux-<span class="keyword">next</span>.build -j8 zImage
 <span class="keyword">make</span>  ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- O=../linux-<span class="keyword">next</span>.build hip04-d01.dtb
 <span class="keyword">cat</span> ../linux-<span class="keyword">next</span>.build/arch/arm/boot/zImage ../linux-<span class="keyword">next</span>.build/arch/arm/boot/dts/hip04-d01.dtb &gt; /$(FTP-server-path)/.kernel
</code></pre></li>
</ol>
<p><a name="nandboot"></a></p>
<h3 id="boot_via_NAND">boot via NAND</h3>
<p>if booting via NAND, could use following method to <a href="#upgradekernel">upgrade kernel and NAND rootfs</a>.<br>And by <a href="#changecommandline">changing the command line</a> to boot into different root filesystem.</p>
<p><a name="upgradekernel"></a></p>
<h4 id="upgrade_kernel_and_NAND_rootfs">upgrade kernel and NAND rootfs</h4>
<p>Boot D01 to UEFI shell. And in EBL, type in these commands:</p>
<ol>
<li><p>IP address config:</p>
<pre><code> &gt; <span class="tag">ifconfig</span> <span class="tag">-s</span> <span class="tag">eth0</span> <span class="attr_selector">[IP.address]</span> <span class="attr_selector">[mask]</span> <span class="attr_selector">[gateway]</span>
   <span class="tag">eg</span>. <span class="tag">ifconfig</span> <span class="tag">-s</span> <span class="tag">eth0</span> 192<span class="class">.168</span><span class="class">.10</span><span class="class">.155</span> 255<span class="class">.255</span><span class="class">.255</span><span class="class">.0</span> 192<span class="class">.168</span><span class="class">.10</span><span class="class">.1</span>
</code></pre></li>
<li><p>download kernel binary from FTP server (Note, filenames must not be changed):  </p>
<pre><code> &gt; <span class="tag">provision</span> <span class="attr_selector">[server.IP]</span> <span class="tag">-u</span> <span class="attr_selector">[user.name]</span> <span class="tag">-p</span> <span class="attr_selector">[passwd]</span> <span class="tag">-f</span> <span class="class">.filesystem</span>
 &gt; <span class="tag">provision</span> <span class="attr_selector">[server.IP]</span> <span class="tag">-u</span> <span class="attr_selector">[user.name]</span> <span class="tag">-p</span> <span class="attr_selector">[passwd]</span> <span class="tag">-f</span> <span class="class">.kernel</span>
   <span class="tag">eg</span>. <span class="tag">provision</span> 192<span class="class">.168</span><span class="class">.10</span><span class="class">.6</span> <span class="tag">-u</span> <span class="tag">dj</span> <span class="tag">-p</span> <span class="tag">dj</span> <span class="tag">-f</span> <span class="class">.filesystem</span>
   <span class="tag">eg</span>. <span class="tag">provision</span> 192<span class="class">.168</span><span class="class">.10</span><span class="class">.6</span> <span class="tag">-u</span> <span class="tag">dj</span> <span class="tag">-p</span> <span class="tag">dj</span> <span class="tag">-f</span> <span class="class">.kernel</span>
</code></pre></li>
<li><p>Reboot D01</p>
</li>
</ol>
<p><a name="changecommandline"></a></p>
<h4 id="show_&amp;_change_kernel_command_line_in_UEFI">show &amp; change kernel command line in UEFI</h4>
<ol>
<li><p>Boot D01 and enter EBL.</p>
</li>
<li><p>Use <code>getlinuxatag</code> to see current kernel parameter:</p>
<pre><code> &gt; getlinuxatag
</code></pre></li>
<li><p>Use <code>changelinuxatag</code> to change kernel cmdline to this:</p>
<pre><code> &gt; changelinuxatag
   <span class="keyword">...</span>
   console=ttyS0,<span class="number">115200</span> initrd=<span class="number">0x10d00000</span>,<span class="number">0x1800000</span> rdinit=/linuxrc earlyprintk
   <span class="keyword">...</span>
</code></pre></li>
<li><p>Use setlinuxatag to save to FLASH</p>
<pre><code> &gt; setlinuxatag
</code></pre></li>
<li><p>Reboot D01 </p>
</li>
</ol>
<p><a name="nandfsboot"></a></p>
<h4 id="boot_into_NAND_rootfs">boot into NAND rootfs</h4>
<ol>
<li><p>Change kernel command line as:</p>
<pre><code>   <span class="variable">console=</span>ttyS0,<span class="number">115200</span> <span class="variable">initrd=</span><span class="number">0</span>x10d00000,<span class="number">0</span>x1800000 <span class="variable">rdinit=</span>/linuxrc earlyprintk
</code></pre></li>
<li><p>Reboot D01 </p>
</li>
</ol>
<p><a name="nfsboot">    </a></p>
<h4 id="boot_into_NFS">boot into NFS</h4>
<p>Before doing that, please make sure you have UEFI, <a href="#bootwrapperhacking">.text, .monitor</a>,<br>and <a href="#upgradekernel">.kernel</a> installed on your D01.<br>(.filesystem is not necessary because kernel will boot with NFS).</p>
<p>On your local env:</p>
<ol>
<li><p>Choose a machine and use it as NFS server.<br>Enable NFS service on it. Please follow the guide in your host Machine<br>on how to do this.</p>
</li>
<li><p>Download Ubuntu NFS server <a href="#osv">image release for D01</a><br>Extract this file. Export this path in NFS’s config.</p>
</li>
</ol>
<p>On D01 board:</p>
<ol>
<li>Boot up the board, and enter UEFI EBL shell.</li>
<li><p>Follow <a href="#changecommandline">this step</a> to update kernel cmdline.<br> Change kernel cmdline to:</p>
<pre><code> console=ttyS<span class="number">0</span>,<span class="number">115200</span> earlyprintk rootfstype=nfsroot root=<span class="regexp">/dev/nfs</span> rw nfsroot=&lt;<span class="constant">NFS</span>-server-ip&gt;<span class="symbol">:&lt;path-to-exported-NFS-files&gt;</span> ip=&lt;client-ip&gt;<span class="symbol">:&lt;NFS-server-ip&gt;</span><span class="symbol">:&lt;gw-ip&gt;</span><span class="symbol">:&lt;netmask&gt;</span><span class="symbol">:</span><span class="symbol">:eth0</span><span class="symbol">:on</span><span class="symbol">:&lt;dns0-ip&gt;</span><span class="symbol">:&lt;dns1-ip&gt;</span> user_debug=<span class="number">31</span> nfsrootdebug
</code></pre><p> Here is an example:</p>
<pre><code> console=ttyS<span class="number">0</span>,<span class="number">115200</span> earlyprintk rootfstype=nfsroot root=<span class="regexp">/dev/nfs</span> rw nfsroot=<span class="number">192.168</span>.<span class="number">0</span>.<span class="number">108</span><span class="symbol">:/Users/docularxu/Downloads/mnt</span> ip=<span class="number">192.168</span>.<span class="number">0</span>.<span class="number">150</span><span class="symbol">:</span><span class="number">192.168</span>.<span class="number">0</span>.<span class="number">108</span><span class="symbol">:</span><span class="number">192.168</span>.<span class="number">0</span>.<span class="number">1</span><span class="symbol">:</span><span class="number">255.255</span>.<span class="number">255.0</span><span class="symbol">:</span><span class="symbol">:eth0</span><span class="symbol">:on</span><span class="symbol">:</span><span class="number">192.168</span>.<span class="number">0</span>.<span class="number">1</span><span class="symbol">:</span><span class="number">8.8</span>.<span class="number">8.8</span> user_debug=<span class="number">31</span> nfsrootdebug
</code></pre><p> Note, this is an example. Please change the values according to your<br> local environment. Explanation of each parameter can be found in kernel<br> source Documentations. Like: </p>
<pre><code>     ip=&lt;client-ip&gt;<span class="symbol">:&lt;server-ip&gt;</span><span class="symbol">:&lt;gw-ip&gt;</span><span class="symbol">:&lt;netmask&gt;</span><span class="symbol">:&lt;hostname&gt;</span><span class="symbol">:&lt;device&gt;</span><span class="symbol">:&lt;autoconf&gt;</span><span class="symbol">:&lt;dns0-ip&gt;</span><span class="symbol">:&lt;dns1-ip&gt;</span>
</code></pre></li>
<li><p>Reboot the board.</p>
</li>
</ol>
<p>After kernel boots and the Console shell is shown up,<br>this means the process is successful. It is recommended to config DNS server,<br>so your board can access the Internet. sudo to edit this file <code>/etc/resolv.conf</code>,<br>and add your DNS server into it. Eg.</p>
<pre><code>    <span class="title">nameserver</span> <span class="number">192.168.0.1</span>
</code></pre><p><a name="ubuntuboot">        </a></p>
<h4 id="boot_into_Ubuntu_on_SATA">boot into Ubuntu on SATA</h4>
<ol>
<li><p>Download Ubuntu server <a href="#osv">release for D01</a></p>
</li>
<li><p>Boot the board with NFS </p>
</li>
<li><p>Partition and Format SATA disk.<br>Create one ext4 partition of at least 10G to host the root filesystem.<br>In my case, it is <code>/dev/sda1</code>.</p>
</li>
<li><p>Mount <code>/dev/sda1</code> to <code>/mnt/sda1</code></p>
<pre><code> mkdir <span class="regexp">/mnt/</span>sda1 <span class="regexp">/mnt/</span>sda3
 mount -t ext4 <span class="regexp">/dev/</span>sda1 <span class="regexp">/mnt/</span>sda1
</code></pre></li>
<li><p>Extract release from Step 1 to <code>/mnt/sda1</code></p>
</li>
<li><p>Unmount <code>/dev/sda1</code></p>
</li>
<li><p>Reboot, and enter UEFI EBL shell.</p>
</li>
<li><p>Change kernel cmdline. Refer to <a href="#changecommandline">above</a> for details how-to.</p>
<pre><code> <span class="variable">console=</span>ttyS0,<span class="number">115200</span> <span class="variable">root=</span>/dev/sda1 <span class="variable">rootfstype=</span>ext4 rw earlyprintk <span class="variable">ip=</span><span class="number">192.168</span>.<span class="number">0.150</span>:<span class="number">192.168</span>.<span class="number">0.108</span>:<span class="number">192.168</span>.<span class="number">0.1</span>:<span class="number">255.255</span>.<span class="number">255.0</span>::eth0:on:<span class="number">192.168</span>.<span class="number">0.1</span>:<span class="number">8.8</span>.<span class="number">8.8</span>
</code></pre></li>
</ol>
<p>Note, you should change /dev/sda1 to according to your SATA disk situation.</p>
<ol>
<li>Reboot the board.</li>
</ol>
<p>After kernel boots and the Console shell is shown up,<br>this means the process is successful. It is recommended to config DNS server,<br>so your board can access the Internet. sudo to edit this file /etc/resolv.conf,<br>and add your DNS server into it. Eg.</p>
<pre><code>    <span class="title">nameserver</span> <span class="number">192.168.0.1</span>
</code></pre><p><a name="pxeboot"></a></p>
<h3 id="boot_via_PXE">boot via PXE</h3>
<p>PXE boot is built upon DHCP and TFTP. So, to verify PXE,<br>the first thing you need to do is to create and set up a TFTP server and DHCP<br>server on your local network. </p>
<p><a name="installtftp"></a></p>
<h4 id="set_up_TFTP_server_on_Ubuntu">set up TFTP server on Ubuntu</h4>
<ol>
<li><p>install TFTP server and TFTP client(optional, tftp-hpa is the client package)</p>
<pre><code> <span class="built_in">sudo</span> apt-get install tftpd-hpa tftp-hpa
</code></pre></li>
<li><p>configure the TFTP server, update <code>/etc/default/tftpd-hpa</code> like following:</p>
<pre><code><span class="constant"> TFTP_USERNAME</span>=tftp
<span class="constant"> TFTP_ADDRESS</span>=<span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">69</span>
<span class="constant"> TFTP_DIRECTORY</span>=/var/lib/tftpboot
<span class="constant"> TFTP_OPTIONS</span>=-l -c -s
</code></pre></li>
<li><p>set up TFTP server directory</p>
<pre><code> sudo mkdir /<span class="reserved">var</span>/lib/tftpboot
 sudo chmod -R <span class="number">777</span> /<span class="reserved">var</span><span class="regexp">/lib/tftpboot/</span>
</code></pre></li>
<li><p>restart TFTP server</p>
<pre><code> service tftpd-hpa status
 service tftpd-hpa restart
 service tftpd-hpa <span class="literal">force</span>-reload
</code></pre></li>
</ol>
<p><a name="installtftp"></a></p>
<h4 id="set_up_DHCP_server_on_Ubuntu">set up DHCP server on Ubuntu</h4>
<p>Refer to https://help.ubuntu.com/community/isc-dhcp-server<br>For a simplified direction, try these steps:</p>
<ol>
<li><p>install DHCP server package</p>
<pre><code> sudo apt-get <span class="operator"><span class="keyword">install</span> isc-dhcp-<span class="keyword">server</span></span>
</code></pre></li>
<li><p>Edit <code>/etc/dhcp/dhcpd.conf</code> to suit your needs and particular configuration.<br> Make sure filename is “grub2.efi”. Here is an example:</p>
<pre><code> $ cat /etc/dhcp/dhcpd.conf
 <span class="preprocessor"># Sample /etc/dhcpd.conf</span>
 <span class="preprocessor"># (add your comments here)</span>
 default-lease-time <span class="number">600</span>;
 <span class="built_in">max</span>-lease-time <span class="number">7200</span>;
 <span class="built_in">option</span> subnet-mask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>;
 <span class="built_in">option</span> broadcast-address <span class="number">192.168</span><span class="number">.0</span><span class="number">.255</span>;
 <span class="built_in">option</span> routers <span class="number">192.168</span><span class="number">.0</span><span class="number">.1</span>;
 <span class="built_in">option</span> domain-name-servers <span class="number">192.168</span><span class="number">.0</span><span class="number">.1</span>;
 <span class="built_in">option</span> domain-name <span class="string">"mydomain.example"</span>;
 subnet <span class="number">192.168</span><span class="number">.0</span><span class="number">.0</span> netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> {
         range <span class="number">192.168</span><span class="number">.0</span><span class="number">.160</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.180</span>;
         <span class="built_in">option</span> subnet-mask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>;
         filename <span class="string">"grub2.efi"</span>;
 }
 <span class="preprocessor">#</span>
</code></pre></li>
<li><p>Edit <code>/etc/default/isc-dhcp-server</code> to specify the interfaces dhcpd<br>should listen to. By default it listens to eth0.<br> Assign a static ip to the interface that you will use for dhcp.</p>
</li>
<li><p>use these commands to start or check dhcp service</p>
<pre><code> <span class="built_in">sudo</span> service isc-dhcp-server status
 <span class="built_in">sudo</span> service isc-dhcp-server start
</code></pre></li>
</ol>
<p><a name="enterpxe"></a></p>
<h4 id="enter_PXE_in_the_UEFI_shell">enter PXE in the UEFI shell</h4>
<p>In the description below, we suppose you have config:</p>
<pre><code>* TFTP root path <span class="keyword">is</span>: <span class="string">`/var/lib/tftpboot`</span>
* DHCP <span class="keyword">default</span> download filename <span class="keyword">is</span>: <span class="string">`grub2.efi`</span>
</code></pre><ol>
<li><p>Download PXE related files from <a href="#release">release</a>: <code>D01.fd, grub2.efi  
grub.cfg, hip04-d01.dtb and zImage</code> or compile them by yourself, could refer to<br><a href="#hacking">hacking section</a> to compile and upgrade UEFI, BootWrapper,<br>Grub and Kernel.</p>
</li>
<li><p>Create folder structure under your TFTP root path,<br>and copy files into it like this:</p>
<pre><code> /var/lib/tftpboot$ tree .
 .
 ├── boot
 │   └── grub
 │       └── grub.cfg
 ├── grub2.efi
 ├── hip04-d01.dtb
 └── z<span class="variable">Image</span>
</code></pre></li>
<li><p>On D01 board need to upgrade to a later UEFI which can support PXE boot.</p>
</li>
<li><p>When booting D01, enter into UEFI Shell, then input these commands in turn:</p>
<pre><code> <span class="number">2</span>      //Boot Manager
 <span class="number">1</span>      //Add Boot Device Entry
 <span class="number">3</span>      //PXE on MAC Address:<span class="keyword">...</span>
 PXE      //Description <span class="keyword">for</span> this new Entry
 <span class="number">5</span>      //Return to main menu
 <span class="number">2</span>      //PXE
</code></pre></li>
</ol>
<p>These will enable the board to download ‘grub2.efi’ and launch it,<br>then in 3 seconds, grub2 will download and boot linux.</p>
<p>A full log is attached here: <a href="https://wiki.linaro.org/Boards/D01/PXE?action=AttachFile&amp;do=view&amp;target=sample.pxe.boot.log.minicom.cap.txt" target="_blank" rel="external">sample.pxe.boot.log.minicom.cap.txt</a></p>
<p><a name="stubboot"></a></p>
<h3 id="boot_via_EFI-stub">boot via EFI-stub</h3>
<p><a name="compilestubkernel"></a></p>
<h4 id="compile_kernel_with_EFI_stub(#compilestubkernel)">compile kernel with EFI stub(#compilestubkernel)</h4>
<p><a name="installefi"></a></p>
<h4 id="install_EFI-stub_kernel_on_SATA_disk(#installefi)">install EFI-stub kernel on SATA disk(#installefi)</h4>
<ol>
<li><p>partition the disk to MBR. use <code>fdisk</code> and <code>mkfs</code><br>command to create a FAT partition. If using D01 </p>
<pre><code> fdisk, <span class="built_in">to</span> <span class="built_in">create</span> <span class="operator">a</span> <span class="string">"Win95"</span> type <span class="operator">of</span> partition. Eg.
 Command (m <span class="keyword">for</span> help): p

 Disk /dev/sdb: <span class="number">500.1</span> GB, <span class="number">500107862016</span> <span class="keyword">bytes</span>
 <span class="number">255</span> heads, <span class="number">63</span> sectors/track, <span class="number">60801</span> cylinders, total <span class="number">976773168</span> sectors
 Units = sectors <span class="operator">of</span> <span class="number">1</span> * <span class="number">512</span> = <span class="number">512</span> <span class="keyword">bytes</span>
 Sector size (logical/physical): <span class="number">512</span> <span class="keyword">bytes</span> / <span class="number">4096</span> <span class="keyword">bytes</span>
 I/O size (minimum/optimal): <span class="number">4096</span> <span class="keyword">bytes</span> / <span class="number">4096</span> <span class="keyword">bytes</span>
 Disk identifier: <span class="number">0x90465146</span>

    Device Boot      Start         End      Blocks   Id  System
 /dev/sdb1            <span class="number">2048</span>    <span class="number">41945087</span>    <span class="number">20971520</span>    b  W95 FAT32
</code></pre></li>
</ol>
<ol>
<li>copy zImage and device tree blob to the FAT partition. If using D01, you<br>could do this by booting via <a href="#nandboot">NAND</a> or <a href="#pxeboot">PXE</a> firstly.</li>
</ol>
<p><a name="enterefi"></a></p>
<h4 id="launch_EFI-stub_Kernel_in_the_UEFI_shell(#enterefi)">launch EFI-stub Kernel in the UEFI shell(#enterefi)</h4>
<ol>
<li><p>boot the board.</p>
</li>
<li><p>Press ‘s’ to Start Boot Menu.</p>
</li>
<li><p>Press ‘4’ to select [4] Shell. You will see something like this</p>
<pre><code> UEFI Interactive Shell v2<span class="class">.0</span>
 EDK II
 UEFI v2<span class="class">.40</span> (ARM D01 EFI May  9 2014 10<span class="value">:<span class="number">43</span>:<span class="number">52</span>, <span class="number">0</span>x00000000)
 Mapping table
 FS1: <span class="function">Alias</span>(s):F0:;</span>BLK5<span class="value">:
 <span class="function">VenMsg</span>(<span class="number">06</span>ED4DD0-FF78-<span class="number">11</span>D3-BDC4-<span class="number">00</span>A0C94053D1,<span class="number">0000000000000000</span>)
 FS0: <span class="function">Alias</span>(s):HD5b0a1:;</span>BLK3<span class="value">:
 <span class="function">Pci</span>(<span class="number">0</span>x0,<span class="number">0</span>x0)/<span class="function">Sata</span>(<span class="number">0</span>x1,<span class="number">0</span>x0,<span class="number">0</span>x0)/<span class="function">HD</span>(<span class="number">1</span>,MBR,<span class="number">0</span>x05A8565C,<span class="number">0</span>x3F,<span class="number">0</span>x5FC6D)
 BLK0: <span class="function">Alias</span>(s):
 <span class="function">Pci</span>(<span class="number">0</span>x0,<span class="number">0</span>x0)/<span class="function">Sata</span>(<span class="number">0</span>x0,<span class="number">0</span>x0,<span class="number">0</span>x0)
 BLK1: <span class="function">Alias</span>(s):
 <span class="function">Pci</span>(<span class="number">0</span>x0,<span class="number">0</span>x0)/<span class="function">Sata</span>(<span class="number">0</span>x0,<span class="number">0</span>x0,<span class="number">0</span>x0)/<span class="function">HD</span>(<span class="number">1</span>,MBR,<span class="number">0</span>x364C8C12,<span class="number">0</span>x800,<span class="number">0</span>x3A385830)
 BLK2: <span class="function">Alias</span>(s):
 <span class="function">Pci</span>(<span class="number">0</span>x0,<span class="number">0</span>x0)/<span class="function">Sata</span>(<span class="number">0</span>x1,<span class="number">0</span>x0,<span class="number">0</span>x0)
 BLK4: <span class="function">Alias</span>(s):
 <span class="function">Pci</span>(<span class="number">0</span>x0,<span class="number">0</span>x0)/<span class="function">Sata</span>(<span class="number">0</span>x1,<span class="number">0</span>x0,<span class="number">0</span>x0)/<span class="function">HD</span>(<span class="number">2</span>,MBR,<span class="number">0</span>x05A8565C,<span class="number">0</span>x5FCAC,<span class="number">0</span>x302C4)
 Press ESC in <span class="number">1</span> seconds to skip startup.nsh or any other key to continue.</span>
</code></pre></li>
<li><p>Command sequence to launch zImage:</p>
<pre><code> Shell&gt; FS0:
 FS0:\&gt; ls
 Directory of: FS0:\
 <span class="number">05</span><span class="regexp">/09/</span><span class="number">2014</span>  <span class="number">02</span>:<span class="number">28</span>           <span class="number">2</span>,<span class="number">665</span>,<span class="number">312</span>  zImage_lt-d01
 <span class="number">05</span><span class="regexp">/09/</span><span class="number">2014</span>  <span class="number">02</span>:<span class="number">28</span>               <span class="number">3</span>,<span class="number">438</span>  hip04-d01.dtb
 <span class="number">01</span><span class="regexp">/01/</span><span class="number">1980</span>  <span class="number">00</span>:<span class="number">00</span> &lt;DIR&gt;         <span class="number">1</span>,<span class="number">536</span>  boot
           <span class="number">2</span> <span class="keyword">File</span>(s)   <span class="number">2</span>,<span class="number">668</span>,<span class="number">750</span> bytes
           <span class="number">1</span> Dir(s)
 FS0:\&gt; zImage_lt-d01 dtb=hip04-d01.dtb console=ttyS0,<span class="number">115200</span> root=<span class="regexp">/dev/</span>sda2 rw earlyprintk
 EFI stub: Booting Linux Kernel...
</code></pre><p> Note: Attached here a reference booting log. minicom_sata.cap<br> Note: only FAT partition is recognizable so far.</p>
</li>
</ol>
<p><a name="grubboot"></a></p>
<h3 id="boot_via_GRUB">boot via GRUB</h3>
<p>Create GRUB configure file like following, or you could download it from<br>the <a href="#release">release</a></p>
<pre><code>    <span class="comment">#</span>
    <span class="comment"># Sample GRUB configuration file</span>
    <span class="comment">#</span>

    <span class="comment"># Boot automatically after 0 secs.</span>
    set <span class="variable">timeout=</span><span class="number">3</span>

    <span class="comment"># By default, boot the D01 kernel</span>
    set <span class="variable">default=</span>NAND

    <span class="comment"># For booting GNU/Linux</span>
    menuentry <span class="string">"D01-NAND"</span> --id NAND {
        devicetree (hd0,msdos1)/hip04-d01.dtb
        linux (hd0,msdos1)/zImage <span class="variable">console=</span>ttyS0,<span class="number">115200</span> earlyprintk <span class="variable">initrd=</span><span class="number">0</span>x10d00000,<span class="number">0</span>x1800000 <span class="variable">rdinit=</span>/linuxrc <span class="variable">ip=</span>dhcp
    }

    menuentry <span class="string">"D01-Ubuntu"</span> --id UBUNTU {
        devicetree (hd0,msdos1)/hip04-d01.dtb
        linux (hd0,msdos1)/zImage <span class="variable">console=</span>ttyS0,<span class="number">115200</span> earlyprintk <span class="variable">root=</span>/dev/sda2 <span class="variable">rootfstype=</span>ext4 rw <span class="variable">ip=</span>dhcp
    }

    menuentry <span class="string">"D01-Opensuse"</span> --id SUSE {
        devicetree (hd0,msdos1)/hip04-d01.dtb
        linux (hd0,msdos1)/zImage <span class="variable">console=</span>ttyS0,<span class="number">115200</span> earlyprintk <span class="variable">root=</span>/dev/sdb1 <span class="variable">rootfstype=</span>ext4 rw <span class="variable">ip=</span>dhcp
    }

    menuentry <span class="string">"D01-NFS"</span> --id NFS {
        devicetree (hd0,msdos1)/hip04-d01.dtb
        linux (hd0,msdos1)/zImage <span class="variable">console=</span>ttyS0,<span class="number">115200</span> earlyprintk <span class="variable">rootfstype=</span>nfsroot <span class="variable">root=</span>/dev/nfs rw <span class="variable">nfsroot=</span><span class="number">192.168</span>.<span class="number">201.25</span>:/home/joyx/develop/d01/workspace/ubuntu-image/binary  <span class="variable">ip=</span><span class="number">192.168</span>.<span class="number">201.39</span>:<span class="number">192.168</span>.<span class="number">201.1</span>::<span class="number">255.255</span>.<span class="number">255.128</span>::eth0:on:<span class="number">192.168</span>.<span class="number">201.1</span>:<span class="number">8.8</span>.<span class="number">8.8</span> 
    }
</code></pre><p><a name="installgrub"></a></p>
<h4 id="install_GRUB_on_SATA_disk">install GRUB on SATA disk</h4>
<p>installing GRUB on SATA disk is similiar with installing<br><a href="#installefi">EFI-stub kernel on SATA</a>.<br>Copy following files into the FAT partition of the SATA disk and the directory tree<br>is like this:</p>
<pre><code>    ├── boot
    │   └── grub
    │       └── grub.cfg
    ├── grub2.efi
    ├── hip04<span class="operator">-d</span>01.dtb
    └── zImage
</code></pre><p><a name="entergrub"></a></p>
<h4 id="launch_GRUB_in_the_UEFI_shell">launch GRUB in the UEFI shell</h4>
<p>When booting D01, enter into UEFI Shell, then input these commands in turn:</p>
<pre><code>    <span class="number">2</span>      //Boot Manager
    <span class="number">1</span>      //Add Boot Device Entry
    <span class="number">2</span>      //Pci(<span class="number">0x0</span>,<span class="number">0x0</span>)/Sata(<span class="number">0x1</span>,<span class="number">0x0</span>,<span class="number">0x0</span>)...
    GRUB2  //File path of the EFI Application <span class="keyword">or</span> the kernel
    <span class="keyword">y</span>      //Is an EFI Application? [<span class="regexp">y/n]
    y      //</span>Is your application is an OS loader? [<span class="regexp">y/n]
    5      //</span>Return to main menu
    <span class="number">3</span>      //GRUB
</code></pre><p>A quick view about GRUB booting is like following:</p>
<p><img src="http://7vilkn.com1.z0.glb.clouddn.com/d01-grub.png" style="width:700px;height:300px;margin-left:30px"> </p>
<p><a name="kvm"></a></p>
<h3 id="KVM_on_D01">KVM on D01</h3>
<p>Host Kernel on D01 is already support KVM.<br>steps to build kernel could refer to <a href="#kernelhacking">Kernal hacking</a>.</p>
<p>Steps to build and run guest:</p>
<ol>
<li><p>Clone the Torvalds kernel</p>
<pre><code> git clone <span class="symbol">git:</span>/<span class="regexp">/git.kernel.org/pub</span><span class="regexp">/scm/linux</span><span class="regexp">/kernel/git</span><span class="regexp">/torvalds/linux</span>.git
</code></pre></li>
<li><p>Checkout to v3.12 branch</p>
<pre><code> <span class="title">git</span> checkout -b linux-<span class="number">3</span>.<span class="number">12</span> v3.<span class="number">12</span>
</code></pre></li>
<li><p>Cross compile the kernel</p>
<pre><code> make <span class="variable">ARCH=</span>arm <span class="variable">CROSS_COMPILE=</span>arm-linux-gnueabihf- vexpress_defconfig
 make <span class="variable">ARCH=</span>arm <span class="variable">CROSS_COMPILE=</span>arm-linux-gnueabihf- -j2
</code></pre></li>
<li><p>Grab Pawel’s DTS tree: git://linux-arm.org/arm-dts.git</p>
<pre><code> git <span class="keyword">clone</span> git:<span class="comment">//linux-arm.org/arm-dts.git</span>
 git chechout -b v3_12 v3<span class="number">.12</span>
</code></pre></li>
<li><p>From your kernel tree, run:</p>
<pre><code> .<span class="regexp">/script/</span>dtc<span class="regexp">/dtc -O dtb -o rtsm_ve-cortex_a15x4.dtb  wherever_your_arm-dts_tree_is/</span>fast_models<span class="regexp">/rtsm_ve-cortex_a15x4.dts</span>
</code></pre></li>
<li><p>Launch QEMU on D01:</p>
<pre><code> qemu-<span class="built_in">system</span>-arm -enable-kvm -kernel zImage -dtb rtsm_ve-cortex_a15x4.dtb -initrd initrd.cpio.gz -<span class="built_in">append</span> <span class="string">"console=ttyAMA0 earlyprintk rdinit=/linuxrc"</span> -nographic -machine vexpress-a15,kernel_irqchip=<span class="keyword">on</span> -<span class="keyword">m</span> <span class="number">128</span> -smp <span class="number">4</span> -cpu cortex-a15 -rtc base=<span class="built_in">localtime</span>
</code></pre></li>
</ol>
<p><a name="xen"></a></p>
<h3 id="Xen_on_D01">Xen on D01</h3>
<p><a name="refer"></a></p>
<h2 id="Reference">Reference</h2>
<ul>
<li>https://wiki.linaro.org/Boards/D01</li>
<li>https://wiki.linaro.org/LEG/Engineering/Kernel/ACPI/ACPIviaEFI</li>
</ul>

        </section>
        <hr/>
        <nav class="pagination" style="width:auto" role="pagination">
            
            <a data-pjax class="newer-posts" href="/2015/04/17/D02/">← Prev Post</a>
            
            <a class="share-button" data-original-title title>Share this Post</a>
            
        </nav>
        <br/>
        <br/>
        <section id="comment">
            <div id="comment-box"></div>
        </section>


    </article>
</main>


  
<footer class="site-footer">
    
    <div class="inner">
        <section class="copyright"><a href="/"></a> &copy; Open-Estuary 2014-2015</section>
        <section class="poweredby">Published with <a target="_blank" href="http://hexo.io/">Hexo   </a> and Theme by <a target="_blank" href="https://github.com/yuche/hexo-theme-kael">Kael</a></section>

		
<script type="text/javascript">
var currenthref = window.location.href;
if(currenthref == "http://open-estuary.github.io/" || currenthref == "http://localhost:4000/"){
var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1254398477'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s11.cnzz.com/z_stat.php%3Fid%3D1254398477%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));
}

</script>



    </div>
</footer>
</div>
</div><!-- /scroller -->

</div><!-- /pusher -->
</div><!-- /container -->
</div>

<!-- Easter eggs -->

<div class="egg animated">
    <a id="close-button" href="#">X</a>
    <div class="block">
        <div class="loading">
            <span class="ball1"></span>
            <span class="ball2"></span>
        </div>
    </div>
</div>

  
<script src="//cdn.staticfile.org/jquery/1.11.0/jquery.min.js"></script>
<script>
    if (!window.jQuery) {
        var script = document.createElement('script');
        script.src = "/js/jquery.min.js";
        document.body.appendChild(script);
    }
</script>
<script type="text/javascript" src="/js/lib.js"></script>
<script type="text/javascript" src="/js/main.js"></script>
<script type="text/javascript" src="/js/jquery.metro-btn.js"></script>






</body>
</html>
