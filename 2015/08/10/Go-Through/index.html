<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>Go Through | Open-Estuary</title>
  <meta name="description" content="Open-Estuary Community Boards Support Site" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/css/component.css" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link rel="stylesheet" type="text/css" href="/css/jq-metro.css" />
  <meta name="generator" content="Open-Estuary">
  <script src="http://static.duoshuo.com/embed.js"></script>
  
  
  

  
</head>
<body>
<div class="container">
    <div class="mp-pusher" id="mp-pusher">
        <i id="scroll-up" class="fa fa-angle-up"></i>
        <nav id="mp-menu" class="mp-menu">
            <div class="mp-level">
                <a data-pjax class="back-home" style="font-size: 20px" href="/"><h2 ><i class="fa fa-home"></i>
                        Home</h2></a>
                <ul class="first-level">
                    <li>
                        <a class="fa fa-archive" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Archive</a>
                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-archive"></i>
                                Archive</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-archive" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/08/10/Overview-Introduction/">Overview Introduction</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/08/10/Quick-Start/">Estuary QuickStart Guide</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/08/10/Go-Through/">Go Through</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/08/10/Binary-Files/">Binary Files</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/08/10/Shared-Boards-in-Open-Lab/">Shared Boards in Open Lab</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/08/10/Caliper-for-Benchmarking/">Caliper for Benchmarking</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/08/10/UEFI-and-Grub/">UEFI and Grub</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/08/10/Hardware-Boards/">Hardware Boards</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/08/10/Armor-Tools/">Armor Tools</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/04/17/D02/">D02-hacking-manual</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2014/12/23/D01/">D01-hacking-manual</a>
                                </li>
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a class="fa fa-copy" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Categories</a>

                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-copy"></i>
                                Categories</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-category" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a class="fa fa-tags" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Tags</a>
                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-tags"></i>
                                Tags</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-tag" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/Armor-Tools/">&nbsp;&nbsp;&nbsp;Armor Tools</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/Binary-Files/">&nbsp;&nbsp;&nbsp;Binary Files</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/Caliper-for-Benchmarking/">&nbsp;&nbsp;&nbsp;Caliper for Benchmarking</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/D01/">&nbsp;&nbsp;&nbsp;D01</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/D02/">&nbsp;&nbsp;&nbsp;D02</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/Go-Through/">&nbsp;&nbsp;&nbsp;Go Through</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/Hardware-Boards/">&nbsp;&nbsp;&nbsp;Hardware Boards</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/Overview-Introduction/">&nbsp;&nbsp;&nbsp;Overview Introduction</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/Quick-Start/">&nbsp;&nbsp;&nbsp;Quick Start</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/Shared-Boards-in-Open-Lab/">&nbsp;&nbsp;&nbsp;Shared Boards in Open Lab</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/UEFI-and-Grub/">&nbsp;&nbsp;&nbsp;UEFI and Grub</a>
                                    <small>1</small>
                                </li>
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    
                    <li><a class="fa fa-user" href="http://www.open-estuary.io">&nbsp;&nbsp;&nbsp;About me</a></li>
                    <li><a class="fa fa-github" href="https://github.com/open-estuary">&nbsp;&nbsp;&nbsp;Github</a></li>
                    <li><a class="fa fa-bullhorn" href="https://github.com/open-estuary/open-estuary.github.io/issues">&nbsp;&nbsp;&nbsp;Issue Report</a></li>
                </ul>

            </div>
        </nav>
        <div id="pjax">
            <div class="pjax-hidden" style="display: none">
                
                    <a  data-pjax href="/2015/08/10/Overview-Introduction/">Overview Introduction</a>
                
                    <a  data-pjax href="/2015/08/10/Quick-Start/">Estuary QuickStart Guide</a>
                
                    <a  data-pjax href="/2015/08/10/Go-Through/">Go Through</a>
                
                    <a  data-pjax href="/2015/08/10/Binary-Files/">Binary Files</a>
                
                    <a  data-pjax href="/2015/08/10/Shared-Boards-in-Open-Lab/">Shared Boards in Open Lab</a>
                
                    <a  data-pjax href="/2015/08/10/Caliper-for-Benchmarking/">Caliper for Benchmarking</a>
                
                    <a  data-pjax href="/2015/08/10/UEFI-and-Grub/">UEFI and Grub</a>
                
                    <a  data-pjax href="/2015/08/10/Hardware-Boards/">Hardware Boards</a>
                
                    <a  data-pjax href="/2015/08/10/Armor-Tools/">Armor Tools</a>
                
                    <a  data-pjax href="/2015/04/17/D02/">D02-hacking-manual</a>
                
                    <a  data-pjax href="/2014/12/23/D01/">D01-hacking-manual</a>
                
                
                
                    <a data-pjax href="/tags/Armor-Tools/">&nbsp;&nbsp;Armor Tools</a>
                
                    <a data-pjax href="/tags/Binary-Files/">&nbsp;&nbsp;Binary Files</a>
                
                    <a data-pjax href="/tags/Caliper-for-Benchmarking/">&nbsp;&nbsp;Caliper for Benchmarking</a>
                
                    <a data-pjax href="/tags/D01/">&nbsp;&nbsp;D01</a>
                
                    <a data-pjax href="/tags/D02/">&nbsp;&nbsp;D02</a>
                
                    <a data-pjax href="/tags/Go-Through/">&nbsp;&nbsp;Go Through</a>
                
                    <a data-pjax href="/tags/Hardware-Boards/">&nbsp;&nbsp;Hardware Boards</a>
                
                    <a data-pjax href="/tags/Overview-Introduction/">&nbsp;&nbsp;Overview Introduction</a>
                
                    <a data-pjax href="/tags/Quick-Start/">&nbsp;&nbsp;Quick Start</a>
                
                    <a data-pjax href="/tags/Shared-Boards-in-Open-Lab/">&nbsp;&nbsp;Shared Boards in Open Lab</a>
                
                    <a data-pjax href="/tags/UEFI-and-Grub/">&nbsp;&nbsp;UEFI and Grub</a>
                
                <a data-pjax class="fa fa-user" href="/about">&nbsp;&nbsp;&nbsp;About me</a>
            </div>
            <nav class="nexus">
                <li  style="border-left: 1px solid #c6d0da;">
                    <a id="trigger" href="#"><i class="fa fa-bars"></i></a>
                </li>
                <li ><a id="nexus-back" href="/">Open-Estuary</a></li>
                
                <div id="nav-container">
                    <div class="post-navbar" style="line-height: 63px;display:none">
                        <li id="navbar-title"><a href="#">Go Through</a></li>
                        <li id="navbar-toc" style="border-left: none">
                            <a style="padding-right: 15px">
                                <span id="toc-content" >Introduction</span><i class="fa fa-chevron-down" ></i>
                            </a>
                            <div class="hidden-box">
                                <ul id="toc"></ul>
                            </div>
                        </li>
                    </div>
                </div>
                
            </nav>

            <div class="scroller">
            <div class="scroller-inner">


<!-- -->
<!--<body class="post-template">-->
<!---->
  

<main class="content" role="main">
    <article class="post" >
    <span class="post-meta">
                  <div class="tag-tile">
                      
                      
                      <a data-pjax href='/tags/Go-Through/' style='color:#D5D5D5'>Go Through</a>
                      
                      
                  </div>
                <h1 class="post-title" style="margin: 14px 0;color:#50585D">Go Through</h1>

                    <div class="post-meta">
                        Post on<span class="fa fa-clock-o"></span>
                        <time datetime="2015-08-10T02:16:19.000Z"
                              itemprop="datePublished">Aug 10 2015</time>
                    </div>
    </span>

        <section class="post-content">
            <h2 id="Go_through_Estuary_Manual">Go through Estuary Manual</h2>
<p>This documentation will lead you to go through the whole project about how to get, build, deploy and bring up target system based on ZERO, of course some contents in it are linked to dedicated page, you can just click the link to get more detail information about the special part.</p>
<h2 id="Overview">Overview</h2>
<ul>
<li><a href="#preparation">Preparation Before Booting</a><ul>
<li><a href="#UEFI">Hardware &amp; UEFI</a></li>
<li><a href="#build">Get\Build Estuary yourself</a></li>
<li><a href="#kernel">Only build kernel</a></li>
<li><a href="#binary">Use binaries direclty</a></li>
</ul>
</li>
<li><a href="#bringup">Bring up System</a><ul>
<li><a href="#NORFLASH">Boot via NORFLASH</a></li>
<li><a href="#PXE">Boot via PXE</a></li>
<li><a href="#SATA">Boot via SATA</a></li>
<li><a href="#ACPI">Boot via ACPI</a></li>
<li><a href="#NFS">Boot via NFS</a></li>
</ul>
</li>
</ul>
<p>All following desriptions will take the D02 boards as example, other boards have the similar steps to hack, for more detail difference, please refer to <a href="/tags/Hardware-Boards/">Hardware Boards</a></p>
<h2 id="Preparation_Before_Boot"><span id="preparation">Preparation Before Boot</span></h2>
<p>You need do some preparation to get all target binaries before you booting system, and you are supposedly using Ubunt newer than 12.04 as your host OS. (But only Ubuntu 12.04 is validated)</p>
<h3 id="Hardware_&amp;_UEFI"><span id="UEFI">Hardware &amp; UEFI</span></h3>
<p>This step is not necessary unless you want ot update UEFI and trust firmware.</p>
<ol>
<li><p>Check the hardware board</p>
<p> Firstly, hardware board should be ready and checked carefully to make sure it is available, more detail information about different hardware board, please refer to <a href="/tags/Hardware-Boards/">Hardware Boards</a></p>
</li>
<li><p>Update UEFI and trust firmware</p>
<p> You can update UEFI and trust firmare yourself based on FTP service, More detail information about it, please refer to <a href="/tags/UEFI-and-Grub/">UEFI and Grub</a></p>
</li>
</ol>
<h3 id="_Get\Build_Estuary_yourself_"><span id="build"> Get\Build Estuary yourself </span></h3>
<p>You can get and build the whole project to get all binaries yourself as follows.</p>
<p><strong>Firstly, to get the whole project as follows:</strong></p>
<pre><code><span class="variable">$mkdir</span> -p ~/bin; <span class="built_in">sudo</span> apt-get update; <span class="built_in">sudo</span> apt-get upgrade -y; <span class="built_in">sudo</span> apt-get install -y curl git
<span class="variable">$curl</span> <span class="string">"https://android-git.linaro.org/gitweb?p=tools/repo.git;a=blob_plain;f=repo;hb=refs/heads/stable"</span> &gt; ~/bin/repo

<span class="variable">$chmod</span> a+x ~/bin/repo; <span class="built_in">echo</span> <span class="string">'export PATH=~/bin:$PATH'</span> &gt;&gt; ~/.bashrc; <span class="keyword">export</span> PATH=~/bin:<span class="variable">$PATH</span>

<span class="variable">$mkdir</span> workdir; <span class="built_in">cd</span> workdir 
</code></pre><p>You just need do one time above steps for first getting this project, but all following steps are necessary for each time getting or updating.</p>
<pre><code>$repo init -<span class="keyword">u</span> <span class="string">"https://github.com/open-estuary/estuary.git"</span> --<span class="keyword">no</span>-repo-verify --repo-url=gi<span class="variable">t:</span>//android.git.linaro.org/tools/repo
$repo <span class="keyword">sync</span>
</code></pre><p>If the repo sync fails during syncing, you can try it again.</p>
<p><strong>Secondly, to build the target system as follows:</strong><br><strong><em>Before building, you must change MAC address at 244 line in “arch/arm64/boot/dts/hisilicon/hip05_xge.dtsi” to adapt MAC address set in UEFI</em></strong></p>
<pre><code>$./estuary/build.sh -p D02 <span class="operator">-d</span> Ubuntu
</code></pre><p>Then you will get all target binaries in ‘build’ directory.</p>
<p>Following command will provide more useful help information about build script.</p>
<pre><code>$./estuary/build.<span class="keyword">sh</span> -<span class="keyword">h</span>
</code></pre><p>For more detail information about system obtaining and building, please refer to the <strong>README</strong> file in <a href="https://github.com/hisilicon/estuary" target="_blank" rel="external">Estuary Source Code</a></p>
<h3 id="_Only_build_kernel_"><span id="kernel"> Only build kernel </span></h3>
<p>You can do as follows, if you only want to rebuild kernel.</p>
<p>1.Clone the latest kernel source code with following command.</p>
<pre><code>git clone http<span class="variable">s:</span>//github.<span class="keyword">com</span>/<span class="keyword">open</span>-estuary/kernel.git
</code></pre><p>2.Install tool chain from <a href="http://releases.linaro.org/14.09/components/toolchain/" target="_blank" rel="external">Linaro Tool Chain</a></p>
<p>3.Build steps as follow:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> ARCH=arm64</div><div class="line"><span class="keyword">export</span> CROSS_COMPILE=aarch64-linux-gnu-</div><div class="line">make defconfig</div><div class="line">make -j16</div><div class="line">make ./hisilicon/hip05<span class="operator">-d</span>02.dtb</div></pre></td></tr></table></figure>

<p>Then there are two files that have been created: Image in the directory <strong>arch/arm64/boot/</strong>, and hip05-d02.dtb in the directory <strong>arch/arm64/boot/dts/hisilicon</strong></p>
<h3 id="_Use_binaries_directly_"><span id="binary"> Use binaries directly </span></h3>
<p>Anyway, before booting up system, all binaries should be avaiable firstly.</p>
<p>You can get them as above description, of course, you can also do a quick trying with all these existing binaries from <a href="/tags/Binary-Files/">Binary Files</a> directly.</p>
<h2 id="Bring_up_System"><span id="bringup">Bring up System</span></h2>
<p>There are several methods to bring up system, you can select following anyone fitting you to boot up.</p>
<h3 id="Boot_via_NORFLASH"><span id="NORFLASH">Boot via NORFLASH</span></h3>
<p>Boot D02 to UEFI SHELL, and type the follow commands in EBL:<br>1.IP address config</p>
<pre><code><span class="title">ifconfig</span> -s eth0 [IP.address] [mask] [gateway]
eg. ifconfig -s eth0 <span class="number">192.168.1.4</span> <span class="number">255.255.255.0</span> <span class="number">192.168.1.1</span>
</code></pre><p>2.Download Image binary file from FTP</p>
<pre><code><span class="tag">provision</span> <span class="attr_selector">[server.IP]</span> <span class="tag">-u</span> <span class="attr_selector">[user.name]</span> <span class="tag">-p</span> <span class="attr_selector">[passwd]</span> <span class="tag">-f</span> <span class="attr_selector">[image.file]</span> <span class="tag">-a</span> <span class="attr_selector">[address]</span>
<span class="tag">norwfmem</span> <span class="attr_selector">[source address]</span> <span class="attr_selector">[offset]</span> <span class="attr_selector">[data length]</span>
<span class="tag">eg</span>. <span class="tag">provision</span> 192<span class="class">.168</span><span class="class">.1</span><span class="class">.107</span> <span class="tag">-u</span> <span class="tag">sch</span> <span class="tag">-p</span> <span class="tag">aaa</span> <span class="tag">-f</span> <span class="tag">Image</span> <span class="tag">-a</span> 100000
    <span class="tag">norwfmem</span> 100000 100000 1<span class="tag">f00000</span>
</code></pre><p>3.Download dtb file from FTP</p>
<pre><code><span class="tag">provision</span> <span class="attr_selector">[server.IP]</span> <span class="tag">-u</span> <span class="attr_selector">[user.name]</span> <span class="tag">-p</span> <span class="attr_selector">[passwd]</span> <span class="tag">-f</span> <span class="attr_selector">[dtb.file]</span> <span class="tag">-a</span> <span class="attr_selector">[address]</span>
<span class="tag">spiwfmem</span> <span class="attr_selector">[source address]</span> <span class="attr_selector">[offset]</span> <span class="attr_selector">[data length]</span>
<span class="tag">eg</span>. <span class="tag">provision</span> 192<span class="class">.168</span><span class="class">.1</span><span class="class">.107</span> <span class="tag">-u</span> <span class="tag">sch</span> <span class="tag">-p</span> <span class="tag">aaa</span> <span class="tag">-f</span> <span class="tag">hip05-d02</span><span class="class">.dtb</span> <span class="tag">-a</span> 100000
    <span class="tag">spiwfmem</span> 100000 300000 100000
</code></pre><p>4.Download filesystem file from FTP</p>
<pre><code><span class="tag">provision</span> <span class="attr_selector">[server.IP]</span> <span class="tag">-u</span> <span class="attr_selector">[user.name]</span> <span class="tag">-p</span> <span class="attr_selector">[passwd]</span> <span class="tag">-f</span> <span class="attr_selector">[filesystem]</span> <span class="tag">-a</span> <span class="attr_selector">[address]</span>
<span class="tag">norwfmem</span> <span class="attr_selector">[source address]</span> <span class="attr_selector">[offset]</span> <span class="attr_selector">[data length]</span>
<span class="tag">eg</span>. <span class="tag">provision</span> 192<span class="class">.168</span><span class="class">.1</span><span class="class">.107</span> <span class="tag">-u</span> <span class="tag">sch</span> <span class="tag">-p</span> <span class="tag">aaa</span> <span class="tag">-f</span> <span class="tag">hulk-hip05</span><span class="class">.cpio</span><span class="class">.gz</span> <span class="tag">-a</span> 100000
    <span class="tag">norwfmem</span> 100000 2000000 4000000
</code></pre><p>5.Reboot D02<br>    exit ESL and select:FLASH Start OS</p>
<p>show &amp; change kernel command line in UEFI</p>
<h3 id="_Boot_via_PXE"><span id="PXE"> Boot via PXE</span></h3>
<p>PXE boot depends on DHCP and TFTP services.So before verifing PXE, you need to setup a working DHCP server and TFTP server on your local network. In this case, my case is on ubuntu.<br>1.Setup DHCP server on ubuntu<br>Refer to <a href="https://help.ubuntu.com/community/isc-dhcp-server" target="_blank" rel="external">https://help.ubuntu.com/community/isc-dhcp-server</a> . For a simplified direction, try these steps:<br>a.Install DHCP server package</p>
<pre><code>sudo apt-get <span class="operator"><span class="keyword">install</span> -y isc-dhcp-<span class="keyword">server</span> syslinux</span>
</code></pre><p>b.Edit /etc/dhcp/dhcpd.conf to suit your needs and particular configuration.Make sure filename is “grub2.efi”. Here is an example:</p>
<pre><code>$ cat /etc/dhcp/dhcpd.conf
<span class="preprocessor"># Sample /etc/dhcpd.conf</span>
<span class="preprocessor"># (add your comments here)</span>
default-lease-time <span class="number">600</span>;
<span class="built_in">max</span>-lease-time <span class="number">7200</span>;
subnet <span class="number">192.168</span><span class="number">.1</span><span class="number">.0</span> netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> {
    range <span class="number">192.168</span><span class="number">.1</span><span class="number">.210</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.250</span>;
    <span class="built_in">option</span> subnet-mask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>;
    <span class="built_in">option</span> domain-name-servers <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span>;
    <span class="built_in">option</span> routers <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span>;
    <span class="built_in">option</span> subnet-mask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>;
    <span class="built_in">option</span> broadcast-address <span class="number">192.168</span><span class="number">.1</span><span class="number">.255</span>;
    filename <span class="string">"grubaa64.efi"</span>;
    <span class="preprocessor">#next-server 192.168.1.107</span>
}
<span class="preprocessor">#</span>
</code></pre><p>c.Edit /etc/default/isc-dhcp-server to specify the interfaces dhcpd should listen to. By default it listens to eth0.</p>
<pre><code><span class="constant">INTERFACES</span>=<span class="string">"eth0"</span>
</code></pre><p>d.Use these commands to start or check dhcp service</p>
<pre><code><span class="built_in">sudo</span> service isc-dhcp-server restart
</code></pre><p>Check status</p>
<pre><code>netstat -<span class="keyword">lu</span>
</code></pre><p>Output</p>
<pre><code>Proto Recv-Q Send-Q Local Address           Foreign Address         State      
udp        0      0 <span class="keyword">*</span>:bootpc                <span class="keyword">*</span>:<span class="keyword">*</span>                                
</code></pre><p>2.Setup TFTP server on ubuntu<br>a.Install TFTP server and TFTP client(optional, tftp-hpa is the client package)</p>
<pre><code><span class="built_in">sudo</span> apt-get install -y topenbsd-inetd ftpd-hpa tftp-hpa lftp
</code></pre><p>b.Edit /etc/inetd.conf, remove #<off># from the beginning of tftp line or add if it not there under #:BOOT: comment.</off></p>
<pre><code>tftp    dgram   udp wait    root    <span class="regexp">/usr/</span>sbin<span class="regexp">/in.tftpd  /</span>usr<span class="regexp">/sbin/i</span>n.tftpd -s <span class="regexp">/var/</span>lib<span class="regexp">/tftpboot</span>
</code></pre><p>c.Enable boot service for inetd</p>
<pre><code>sudo <span class="operator"><span class="keyword">update</span>-inetd <span class="comment">--enable BOOT</span></span>
</code></pre><p>d.Configure the TFTP server, update /etc/default/tftpd-hpa like following:</p>
<pre><code><span class="constant">TFTP_USERNAME</span>=<span class="string">"tftp"</span>
<span class="constant">TFTP_ADDRESS</span>=<span class="string">"0.0.0.0:69"</span>
<span class="constant">TFTP_DIRECTORY</span>=<span class="string">"/var/lib/tftpboot"</span>
<span class="constant">TFTP_OPTIONS</span>=<span class="string">"-l -c -s"</span>
</code></pre><p>e.Set up TFTP server directory</p>
<pre><code>sudo mkdir /<span class="reserved">var</span>/lib/tftpboot
sudo chmod -R <span class="number">777</span> /<span class="reserved">var</span><span class="regexp">/lib/tftpboot/</span>
</code></pre><p>f.Restart inet &amp; TFTP server</p>
<pre><code><span class="built_in">sudo</span> service openbsd-inetd restart
<span class="built_in">sudo</span> service tftpd-hpa restart
</code></pre><p>Check status</p>
<pre><code>netstat -<span class="keyword">lu</span>
</code></pre><p>Output</p>
<pre><code>Proto Recv-Q Send-Q Local Address           Foreign Address         State 
udp        0      0 <span class="keyword">*</span>:tftp                  <span class="keyword">*</span>:<span class="keyword">*</span>                          
</code></pre><p>3.Prepare some files on the TFTP root path<br>    The files include:grub binary file, grub configure file,Image and dtb file. In my case, they are grubaa64_linux.efi, grub.cfg-01-xx-xx-xx-xx-xx-xx,hip05-d02.dtb and Image.</p>
<p><strong><em>Note:The grub configure file grub.cfg-01-xx-xx-xx-xx-xx-xx ends in D02’s mac address.</em></strong></p>
<p>4.Reboot and enter UEFI boot menu<br>5.Select boot from PXE<br>After seral seconds,D02 will boot automaticlly.<br>The content of grub config file as follow:</p>
<pre><code><span class="preprocessor">#</span>
<span class="preprocessor"># Sample GRUB configuration file</span>
<span class="preprocessor">#</span>
<span class="preprocessor"># Boot automatically after 0 secs.</span>
<span class="keyword">set</span> timeout=<span class="number">5</span>
<span class="preprocessor"># By default, boot the Euler/Linux</span>
<span class="keyword">set</span> <span class="keyword">default</span>=minilinux
<span class="preprocessor"># For booting GNU/Linux</span>
menuentry <span class="string">"Mini-Linux"</span> --id minilinux {
    <span class="keyword">set</span> root=(tftp,<span class="number">192.168</span><span class="number">.1</span><span class="number">.110</span>)
    linux /Image rdinit=/init console=ttyS0,<span class="number">115200</span> earlycon=uart8250,mmio32,<span class="number">0x80300000</span>
    initrd /hulk-hip05.cpio.gz
    devicetree /hip05-d02.dtb
}
</code></pre><p><strong><em>Note: minilinux is the name of default PXE that will boot automatically.Image is the name of kernel that locates on root directory of TFTP.hip05-d02.dtb is the name of dtb file that locates on root directory of TFTP.hulk-hip05.cpio.gz is the name of filesystem that locates on root diretory of TFTP.And you can change the names and locations.</em></strong></p>
<h3 id="_Boot_via_SATA"><span id="SATA"> Boot via SATA</span></h3>
<p>This part will tell you how to boot D02 via GRUB on SATA disk.In my case, SATA disk<br>will be partitioned into five parts:sda1(EFI part),sda2(ubuntu release),sda3(OpenSUSE release),sda4(miniDistribution),sda5(for user).<br>1.Partition and format SATA disk<br>    Format SATA disk: mkfs -t ext4 /dev/sda<br>    Partition SATA disk as follow:</p>
<pre><code><span class="code">+---------+</span>-----------<span class="code">+--------------+</span>------------------+
<span class="header">| Name    |   Size    |    Type      |   Tag            |
+---------+-----------+--------------+------------------+</span>
<span class="header">| sda1    |   200M    |  EFI system  |   EFI            |
+---------+-----------+--------------+------------------+</span>
<span class="header">| sda2    |   10G     |    ext4      | linux filesystem |
+---------+-----------+--------------+------------------+</span>
<span class="header">| sda3    |   10G     |    ext4      | linux filesystem |
+---------+-----------+--------------+------------------+</span>
<span class="header">| sda4    |   10G     |    ext4      | linux filesystem |
+---------+-----------+--------------+------------------+</span>
| sda5    |rest space |    ext4      | linux swap       |
<span class="code">+---------+</span>-----------<span class="code">+--------------+</span>------------------+ 
**<span class="strong">*Note:EFI system should have a fat filesystem, so we should format sda1 with "mkfs.vfat /dev/sda1".*</span>*<span class="strong">*</span>
</code></pre><h3 id="How_to_process_with_the_disk_when_the_disk_is_not_identified_by_D02_board">How to process with the disk when the disk is not identified by D02 board</h3>
<p>when the disk is not identified by D02, you can try the following step to process the disk.(for some specfic disk eg seagate disk made by samsung, it can be useful)<br>a.Find a pc or another board which can identify this disk<br>You should find a pc or another board which can identify this disk, and the system of pc or board should be linux system. For us,we can use D01 board.</p>
<p>b.Use tool fdisk to process this disk</p>
<pre><code><span class="built_in">format</span> <span class="operator">the</span> disk firstly: 
                    mkfs.ext4 /dev/sda
<span class="built_in">add</span> <span class="operator">a</span> gpt <span class="built_in">to</span> this disk : 
                    fdisk /dev/sda
                    g<span class="comment">-------add a gpt partition</span>
<span class="built_in">add</span> some EFI partition : 
                    n<span class="comment">-------add a partition</span>
                    <span class="number">1</span><span class="comment">-------the number of partition</span>
                    +<span class="number">200</span>M<span class="comment">---------size of partition</span>
                    t<span class="comment">-------change the type of partition</span>
                    EFI <span class="keyword">system</span>
<span class="built_in">add</span> some anther partition  ...
save <span class="operator">the</span> change           : w
formate EFI partition  : mkfs.vfat /dev/sda1
</code></pre><p>Then this disk can be identified by D02 board.</p>
<p>2.Relative files are placed as follow:</p>
<pre><code>    sda1: -------EFI
          <span class="string">|       |</span>
          <span class="string">|       GRUB2-----archaa64.efi</span>
          <span class="string">|            |</span>
          <span class="string">|            ------grub.cfg</span>
          <span class="string">|</span>
          <span class="string">|-------------Image</span>
          <span class="string">|</span>
          <span class="string">|-------------hip05-d02.dtb</span>
    sda2: ubuntu distribution
    sda3: OpenSUSE distribution
    sda4: miniDistribution
    sda5: reserved for user
</code></pre><p><strong><em>Note:The names of grub files archaa64.efi is the same name with filename item in DHCP configure file /etc/dhcp/dhcpd.conf.</em></strong></p>
<p>3.modify grub config file according to situation<br>This part we will build 6 different grub config.They are as follow:</p>
<pre><code><span class="code">+-----------+</span>-----------<span class="code">+----------------+</span>------------------+
<span class="header">| boot name |  kernel   |  distribution  |  dtb file        |
+-----------+-----------+----------------+------------------+</span>
<span class="header">| ubuntu    |Image      |    ubuntu      |  hip05-d02.dtb   |
+-----------+-----------+----------------+------------------+</span>
<span class="header">| opensuse  |Image      |    opensuse    |  hip05-d02.dtb   |
+-----------+-----------+----------------+------------------+</span>
<span class="header">| mini      |Image      |    mini        |  hip05-d02.dtb   |
+-----------+-----------+----------------+------------------+</span>
</code></pre><p>And the context of grub.cfg file is as follow:</p>
<pre><code><span class="comment">#</span>
<span class="comment"># Sample GRUB configuration file</span>
<span class="comment">#</span>
<span class="comment"># Boot automatically after 0 secs.</span>
set <span class="variable">timeout=</span><span class="number">5</span>
<span class="comment"># By default, boot the Euler/Linux</span>
set <span class="variable">default=</span>ubuntu
<span class="comment"># For booting GNU/Linux</span>

menuentry <span class="string">"ubuntu"</span> --id ubuntu {
    set <span class="variable">root=</span>(hd1,gpt1)
    linux /Image <span class="variable">rdinit=</span>/init <span class="variable">root=</span>/dev/sda2 <span class="variable">rootfstype=</span>ext4 rw <span class="variable">console=</span>ttyS0,<span class="number">115200</span> <span class="variable">earlycon=</span>uart8250,mmio32,<span class="number">0</span>x80300000
    devicetree /hip05-d02.dtb
}
menuentry <span class="string">"opensuse"</span> --id opensuse {
    set <span class="variable">root=</span>(hd1,gpt1)
    linux /Image <span class="variable">rdinit=</span>/init <span class="variable">root=</span>/dev/sda3 <span class="variable">rootfstype=</span>ext4 rw <span class="variable">console=</span>ttyS0,<span class="number">115200</span> <span class="variable">earlycon=</span>uart8250,mmio32,<span class="number">0</span>x80300000
    devicetree /hip05-d02.dtb
}
menuentry <span class="string">"mini"</span> --id mini {
    set <span class="variable">root=</span>(hd1,gpt1)
    linux /Image <span class="variable">rdinit=</span>/init <span class="variable">root=</span>/dev/sda4 <span class="variable">rootfstype=</span>ext4 rw <span class="variable">console=</span>ttyS0,<span class="number">115200</span> <span class="variable">earlycon=</span>uart8250,mmio32,<span class="number">0</span>x80300000
    devicetree /hip05-d02.dtb
}
</code></pre><p><strong><em>Note:If you only want to boot D02 from one kernel and a distribution,one menuentry is left as above.</em></strong></p>
<p>4.Reboot and enter UEFI menu<br>5.Select boot from HD<br>6.Type arrow key up and down to select grub boot menu to decise which kernel and distribution to boot</p>
<h3 id="_Boot_via_ACPI"><span id="ACPI"> Boot via ACPI</span></h3>
<p>D02 also supports booting via ACPI,and the steps are as follows:<br>1.Power on and enter UEFI SHELL<br>2.IP address config</p>
<pre><code><span class="title">ifconfig</span> -s eth0 [IP.address] [mask] [gateway]
eg. ifconfig -s eth0 <span class="number">192.168.1.4</span> <span class="number">255.255.255.0</span> <span class="number">192.168.1.1</span>
</code></pre><p>3.Burn the kernel from FTP</p>
<pre><code><span class="tag">provision</span> <span class="attr_selector">[server.address]</span> <span class="tag">-u</span> <span class="attr_selector">[user.name]</span> <span class="tag">-p</span> <span class="attr_selector">[passwd]</span> <span class="tag">-f</span> <span class="attr_selector">[kernel]</span> <span class="tag">-a</span> <span class="attr_selector">[address1]</span>
<span class="tag">mdfile</span> \<span class="attr_selector">[kernel]</span> <span class="attr_selector">[address1]</span> <span class="attr_selector">[address2]</span>
<span class="tag">eg</span>. <span class="tag">provision</span> 192<span class="class">.168</span><span class="class">.1</span><span class="class">.107</span> <span class="tag">-u</span> <span class="tag">d02</span> <span class="tag">-p</span> 123456 <span class="tag">-f</span> <span class="tag">Image</span> <span class="tag">-a</span> 0<span class="tag">x80000</span>
    <span class="tag">mdfile</span> \<span class="tag">Image</span> 0<span class="tag">x80000</span> 0<span class="tag">x82A000</span>
</code></pre><p><strong><em>Note:address2 is the real Image size which can be got from above command.</em></strong></p>
<p>4.Burn the filesystem from FTP</p>
<pre><code><span class="tag">provision</span> <span class="attr_selector">[server.address]</span> <span class="tag">-u</span> <span class="attr_selector">[user.name]</span> <span class="tag">-p</span> <span class="attr_selector">[passwd]</span> <span class="tag">-f</span> <span class="attr_selector">[filesystem.cpio.gz]</span> <span class="tag">-a</span> <span class="attr_selector">[address3]</span>
<span class="tag">mdfile</span> \<span class="attr_selector">[filesystem.cpio.gz [address3]</span> <span class="attr_selector">[address4]</span>
<span class="tag">eg</span>. <span class="tag">provision</span> 192<span class="class">.168</span><span class="class">.1</span><span class="class">.107</span> <span class="tag">-u</span> <span class="tag">d02</span> <span class="tag">-p</span> 123456 <span class="tag">-f</span> <span class="tag">hulk-hip05</span><span class="class">.cpio</span><span class="class">.gz</span> <span class="tag">-a</span> 0<span class="tag">x7000000</span>
    <span class="tag">mdfile</span> \<span class="tag">hulk-hip05</span><span class="class">.cpio</span><span class="class">.gz</span> 0<span class="tag">x7000000</span> 0<span class="tag">x1845F12</span>
</code></pre><p><strong><em>Note:address4 is the real Image size which can be got from above command.</em></strong></p>
<p>5.Get into directory to check whether boot via ACPI is done</p>
<pre><code><span class="keyword">cd</span> fs0:
<span class="keyword">dir</span>
</code></pre><p>6.Set the parameters of booting via ACPI</p>
<pre><code>start <span class="keyword">Image</span> <span class="string">"acpi=fore console=ttyS0,115200 earlycon=uart8250,mmio32,0x80300000 initrd=hulk-hip05.cpio.gz"</span>
</code></pre><h3 id="Boot_via_NFS"><span id="NFS">Boot via NFS</span></h3>
<p>D02 supports booting via NFS, and before this step you should make sure that NFS service has been installed.<br>1.Setup NFS service on ubuntu<br>a.Install NFS service package</p>
<pre><code>sudo apt-get <span class="operator"><span class="keyword">install</span> nfs-kernel-<span class="keyword">server</span> nfs-common portmap</span>
</code></pre><p>b.Modify configure file /etc/exports<br>Add contents at the end of this file as follows:</p>
<pre><code>/rootnfs *(rw,<span class="keyword">sync</span>,no_root_squash)
</code></pre><p><strong><em>Note:/rootnfs is the shared directory of nfs.</em></strong><br>c.Restart nfs service </p>
<pre><code><span class="built_in">sudo</span> service nfs-kernel-server restart
</code></pre><p>2.Modify grub config file grub.cfg according to situation</p>
<pre><code>set <span class="variable">timeout=</span><span class="number">0</span>
set <span class="variable">default=</span>nfsboot
menuentry <span class="string">"nfs-boot"</span> --id nfsboot {
    set <span class="variable">root=</span>(tftp,<span class="number">192.168</span>.<span class="number">1.107</span>)
    linux /Image <span class="variable">rdinit=</span>/init <span class="variable">console=</span>ttyS0,<span class="number">115200</span> <span class="variable">earlycon=</span>uart8250,mmio32,<span class="number">0</span>x80300000 <span class="variable">root=</span>/dev/nfs rw <span class="variable">nfsroot=</span><span class="number">192.168</span>.<span class="number">1.107</span>:/home/chenxiang/nfs <span class="variable">ip=</span>:::::eth0:dhcp
    devicetree /hip05-d02.dtb
}
</code></pre><p>Note:Image is the kernel , and hip05-d02 is the dtb file. And the filesystem locates on <strong><em>192.168.1.107:/home/chenxiang/nfs</em></strong><br>3.Reboot D02 and enter UEFI menu.<br>4.Select item 2: PXE on MAC Address.</p>

        </section>
        <hr/>
        <nav class="pagination" style="width:auto" role="pagination">
            
            <a data-pjax class="newer-posts" href="/2015/08/10/Quick-Start/">← Prev Post</a>
            
            <a class="share-button" data-original-title title>Share this Post</a>
            
            <a data-pjax class="older-posts" href="/2015/08/10/Binary-Files/">Next Post →</a>
            
        </nav>
        <br/>
        <br/>
        <section id="comment">
            <div id="comment-box"></div>
        </section>


    </article>
</main>


  
<footer class="site-footer">
    
    <div class="inner">
        <section class="copyright"><a href="/"></a> &copy; Open-Estuary 2014-2015</section>
        <section class="poweredby">Published with <a target="_blank" href="http://hexo.io/">Hexo   </a> and Theme by <a target="_blank" href="https://github.com/yuche/hexo-theme-kael">Kael</a></section>

		
<script type="text/javascript">
var currenthref = window.location.href;
if(currenthref == "http://open-estuary.github.io/" || currenthref == "http://localhost:4000/"){
var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1254398477'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s11.cnzz.com/z_stat.php%3Fid%3D1254398477%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));
}

</script>



    </div>
</footer>
</div>
</div><!-- /scroller -->

</div><!-- /pusher -->
</div><!-- /container -->
</div>

<!-- Easter eggs -->

<div class="egg animated">
    <a id="close-button" href="#">X</a>
    <div class="block">
        <div class="loading">
            <span class="ball1"></span>
            <span class="ball2"></span>
        </div>
    </div>
</div>

  
<script src="//cdn.staticfile.org/jquery/1.11.0/jquery.min.js"></script>
<script>
    if (!window.jQuery) {
        var script = document.createElement('script');
        script.src = "/js/jquery.min.js";
        document.body.appendChild(script);
    }
</script>
<script type="text/javascript" src="/js/lib.js"></script>
<script type="text/javascript" src="/js/main.js"></script>
<script type="text/javascript" src="/js/jquery.metro-btn.js"></script>






</body>
</html>
